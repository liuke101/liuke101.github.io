<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>UE输入系统 | 游戏江湖</title><meta name="author" content="灵玉"><meta name="copyright" content="灵玉"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="增强输入Enhanced Input System 是对默认输入系统做了一个扩展，它以模块化的方式解耦了从输入的按键配置到事件处理的逻辑处理过程，提供了更灵活和更便利的输入配置和处理功能。同时又能向后兼容虚幻引擎 4 (UE4）中的默认输入系统。以插件的形式供我们使用。 重要的类：  UInputAction 输入操作，简称IA 是交互角色可能做出的任何动作，独立于原始输入，可以设置多种类型的输入">
<meta property="og:type" content="article">
<meta property="og:title" content="UE输入系统">
<meta property="og:url" content="http://liuke101.github.io/post/28207.html">
<meta property="og:site_name" content="游戏江湖">
<meta property="og:description" content="增强输入Enhanced Input System 是对默认输入系统做了一个扩展，它以模块化的方式解耦了从输入的按键配置到事件处理的逻辑处理过程，提供了更灵活和更便利的输入配置和处理功能。同时又能向后兼容虚幻引擎 4 (UE4）中的默认输入系统。以插件的形式供我们使用。 重要的类：  UInputAction 输入操作，简称IA 是交互角色可能做出的任何动作，独立于原始输入，可以设置多种类型的输入">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/I168.png">
<meta property="article:published_time" content="2023-10-15T16:00:00.000Z">
<meta property="article:modified_time" content="2024-08-08T17:07:00.263Z">
<meta property="article:author" content="灵玉">
<meta property="article:tag" content="UEC++">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/I168.png"><link rel="shortcut icon" href="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202404232138939.png"><link rel="canonical" href="http://liuke101.github.io/post/28207.html"><link rel="preconnect" href="//cdn.jsdmirror.com"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="6wt4eQbcmYIioyaSsUswEjImObRq1GoUZP_ZRoEoOXc"/><meta name="msvalidate.01" content="9315C074B7CC1C8996DDD5A9533EF368"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?1d08ce745bb272195666f030857b5f8b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"QTHLKKVLAS","apiKey":"7f01e97a350ca196bda1df9cd9168b30","indexName":"hexo","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 灵玉","link":"链接: ","source":"来源: 游戏江湖","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#804bfb","bgDark":"#804bfb","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdmirror.com/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'UE输入系统',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-09 01:07:00'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/I168.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">78</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202404232157234.png')"><nav id="nav"><span id="blog-info"><a href="/" title="游戏江湖"><span class="site-name">游戏江湖</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">UE输入系统</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-15T16:00:00.000Z" title="发表于 2023-10-16 00:00:00">2023-10-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-08T17:07:00.263Z" title="更新于 2024-08-09 01:07:00">2024-08-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%99%9A%E5%B9%BB%E5%BC%95%E6%93%8E/">虚幻引擎</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="UE输入系统"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/post/28207.html#post-comment"><span class="waline-comment-count" data-path="/post/28207.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="增强输入"><a href="#增强输入" class="headerlink" title="增强输入"></a>增强输入</h1><p><code>Enhanced Input System</code> 是对默认输入系统做了一个扩展，它以模块化的方式解耦了从输入的按键配置到事件处理的逻辑处理过程，提供了更灵活和更便利的输入配置和处理功能。同时又能向后兼容虚幻引擎 4 (UE4）中的默认输入系统。以插件的形式供我们使用。</p>
<p><strong>重要的类：</strong></p>
<ul>
<li><code>UInputAction</code> 输入操作，简称<code>IA</code><ul>
<li>是交互角色可能做出的任何动作，独立于原始输入，可以设置多种类型的输入值</li>
</ul>
</li>
<li><code>UInputMappingContext</code> 输入映射上下文, 简称<code>IMC</code><ul>
<li>将用户的输入映射到操作，并可以动态地为每个用户添加、移除或安排优先次序。通过**本地玩家子系统<code>UEnhancedInputLocalPlayerSubsystem</code>将一个或多个映射应用到本地玩家，并安排它们的优先次序，避免多个操作由于尝试使用同一输入而发生冲突</li>
</ul>
</li>
<li><code>UInputModifier</code> 输入修饰符。简称<code>IM</code><ul>
<li>调整来自用户设备的原始输入的值，如使用 Negate 可以将输入值取负值。</li>
</ul>
</li>
<li><code>UInputTrigeer</code> 输入触发器。简称 <code>IT</code><ul>
<li>根据特定的条件来确定是否应该激活输入操作。</li>
</ul>
</li>
</ul>
<p><strong>增强输入系统优点</strong></p>
<ul>
<li><p>统一案件绑定： Axis&#x2F;Action —&gt; Action（统一）</p>
</li>
<li><p>运行时重新映射输入场景： UInputMappingContext</p>
</li>
<li><p>对初级用户易配置。大量默认行为实现，Tap&#x2F;Hold…</p>
</li>
<li><p>对高级用户易扩展，可继承子类扩展</p>
</li>
<li><p>修改器：修改输入值</p>
</li>
<li><p>触发器：决定触发条件</p>
</li>
<li><p>优先级：配置输入场景优先级</p>
</li>
<li><p>模块化，不再只依赖 Ini 配置，以资源 asset 方式配置，堆栈式分隔逻辑</p>
</li>
<li><p>提高性能，不需要检查所有</p>
</li>
</ul>
<h2 id="蓝图与-C-实现"><a href="#蓝图与-C-实现" class="headerlink" title="蓝图与 C++实现"></a>蓝图与 C++实现</h2><p>可以参考引擎的模板 Character</p>
<h3 id="创建-InputAction"><a href="#创建-InputAction" class="headerlink" title="创建 InputAction"></a>创建 InputAction</h3><p> <img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050013.png" alt="Pasted image 20231204221456"></p>
<h3 id="创建-InputMappingContext"><a href="#创建-InputMappingContext" class="headerlink" title="创建 InputMappingContext"></a>创建 InputMappingContext</h3><p> <img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050014.png" alt="Pasted image 20231204221509"> <img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050015.png" alt="Pasted image 20231204221529"></p>
<h3 id="添加输入映射上下文"><a href="#添加输入映射上下文" class="headerlink" title="添加输入映射上下文"></a>添加输入映射上下文</h3><p>在 <code>PlayerController</code> 添加创建的输入映射上下文，可以添加多个上下文 !<img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050016.png" alt="Pasted image 20231204221559"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span>  <span class="title class_">ATestPlayerController</span> : <span class="keyword">public</span> APlayerController  </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">protected</span>:  </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BeginPlay</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:  </span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditDefaultsOnly, Category = <span class="string">&quot;Maga_Input&quot;</span>)  </span><br><span class="line">    TObjectPtr&lt;UInputMappingContext&gt; InputMappingContext;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ATestPlayerController::BeginPlay</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Super::<span class="built_in">BeginPlay</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//添加InputMappingContext</span></span><br><span class="line">	<span class="keyword">if</span> (InputMappingContext)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (UEnhancedInputLocalPlayerSubsystem* Subsystem = ULocalPlayer::<span class="built_in">GetSubsystem</span>&lt;UEnhancedInputLocalPlayerSubsystem&gt;(<span class="built_in">GetLocalPlayer</span>()))</span><br><span class="line">		&#123;</span><br><span class="line">			Subsystem-&gt;<span class="built_in">AddMappingContext</span>(InputMappingContext, <span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用-InputAction-事件"><a href="#使用-InputAction-事件" class="headerlink" title="使用 InputAction 事件"></a>使用 InputAction 事件</h3><p>在蓝图中调用事件很简单：<img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050017.png" alt="Pasted image 20231204221614|400"></p>
<p>在 C++实现如下，需要将需要绑定的 InputAction 一一声明，然后在角色蓝图中设置调用：<br><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050018.png" alt="Pasted image 20231204222600|550"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">//回调函数</span></span><br><span class="line">	<span class="comment">/** Called for movement input */</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">(<span class="type">const</span> FInputActionValue&amp; Value)</span></span>;</span><br><span class="line">	<span class="comment">/** Called for looking input */</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Look</span><span class="params">(<span class="type">const</span> FInputActionValue&amp; Value)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 重载该函数 </span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">SetupPlayerInputComponent</span><span class="params">(<span class="keyword">class</span> UInputComponent* PlayerInputComponent)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明InputAction</span></span><br><span class="line">    <span class="comment">/** Jump Input Action */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category = Input, meta = (AllowPrivateAccess = <span class="string">&quot;true&quot;</span>))</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">UInputAction</span>* JumpAction;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Move Input Action */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category = Input, meta = (AllowPrivateAccess = <span class="string">&quot;true&quot;</span>))</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">UInputAction</span>* MoveAction;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Look Input Action */</span></span><br><span class="line">    <span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category = Input, meta = (AllowPrivateAccess = <span class="string">&quot;true&quot;</span>))</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">UInputAction</span>* LookAction;</span><br></pre></td></tr></table></figure>

<p>在 <code>SetupPlayerInputComponent()</code> 中绑定委托回调</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ATestPlayerController::SetupPlayerInputComponent</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Super::<span class="built_in">SetupInputComponent</span>();</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// Set up action bindings</span></span><br><span class="line">	<span class="keyword">if</span> (UEnhancedInputComponent* EnhancedInputComponent = <span class="built_in">CastChecked</span>&lt;UEnhancedInputComponent&gt;(InputComponent)) &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//Jumping</span></span><br><span class="line">		EnhancedInputComponent-&gt;<span class="built_in">BindAction</span>(JumpAction, ETriggerEvent::Triggered, <span class="keyword">this</span>, &amp;ACharacter::Jump);</span><br><span class="line">		EnhancedInputComponent-&gt;<span class="built_in">BindAction</span>(JumpAction, ETriggerEvent::Completed, <span class="keyword">this</span>, &amp;ACharacter::StopJumping);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//Moving</span></span><br><span class="line">		EnhancedInputComponent-&gt;<span class="built_in">BindAction</span>(MoveAction, ETriggerEvent::Triggered, <span class="keyword">this</span>, &amp;AProjectGASRPGCharacter::Move);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//Looking</span></span><br><span class="line">		EnhancedInputComponent-&gt;<span class="built_in">BindAction</span>(LookAction, ETriggerEvent::Triggered, <span class="keyword">this</span>, &amp;AProjectGASRPGCharacter::Look);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>单独对 Looking 的委托绑定进行解析，我们可以从中看出 C++和蓝图实现的关联 ：</p>
<p><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050019.png" alt="Pasted image 20231204221614"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Looking</span></span><br><span class="line">EnhancedInputComponent-&gt;<span class="built_in">BindAction</span> (LookAction, ETriggerEvent:: Triggered, <span class="keyword">this</span>, &amp;AProjectGASRPGCharacter::Look);</span><br><span class="line"></span><br><span class="line"><span class="comment">//回调</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AProjectGASRPGCharacter::Look</span><span class="params">(<span class="type">const</span> FInputActionValue&amp; Value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// input is a Vector2D</span></span><br><span class="line">	FVector2D LookAxisVector = Value.<span class="built_in">Get</span>&lt;FVector2D&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (Controller != <span class="literal">nullptr</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// add yaw and pitch input to controller</span></span><br><span class="line">		<span class="built_in">AddControllerYawInput</span>(LookAxisVector.X);</span><br><span class="line">		<span class="built_in">AddControllerPitchInput</span>(LookAxisVector.Y);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BindAction 参数解析：</p>
<ol>
<li><code>LookAction</code>：要绑定的 InputAction</li>
<li><code>ETriggerEvent:: Triggered</code> 对应蓝图节点的 Triggered</li>
<li>最后一个参数：触发 Triggered 时的回调函数。</li>
</ol>
<p>回调函数解析：</p>
<ol>
<li>通过 <code>Value. Get&lt;T&gt;</code> 输入值，类型是由 IA  中的 ValueType 指定</li>
<li>然后就可以根据输入值执行游戏逻辑了</li>
</ol>
<h2 id="增强输入用法：控制角色跳跃与移动"><a href="#增强输入用法：控制角色跳跃与移动" class="headerlink" title="增强输入用法：控制角色跳跃与移动"></a>增强输入用法：控制角色跳跃与移动</h2><h3 id="Input-Action"><a href="#Input-Action" class="headerlink" title="Input Action"></a>Input Action</h3><p><strong>定义一个 <code>InputAction</code>，等同于一个自定义事件</strong>，声明输出值类型、触发时机，<code>Modifier</code> 可用于调整输出值</p>
<p>新建 <code>IA_Jump</code> 和 <code>IA_Move</code>：</p>
<p><code>IA_Jump</code> 定义 bool 输出值:</p>
<p>控制跳跃只需要一个 bool 值或浮点数（一个轴的值）即可<br><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050020.png" alt="Pasted image 20231204223713"><br><code>IA_Move</code> 定义 2D 向量（两个轴的值）输出值，通过获取 x 轴与 y 轴值来分别控制左右移动与前后移动<br><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050021.png" alt="Pasted image 20231204223755"><br>也可以通过定义两个浮点数的 InputAction 来分别控制左右移动与前后移动</p>
<h3 id="Input-Mapping-Context-IMC"><a href="#Input-Mapping-Context-IMC" class="headerlink" title="Input Mapping Context (IMC)"></a>Input Mapping Context (IMC)</h3><p>IMC 定义 IC 与按键的绑定关系，实现按键触发动作事件<br>在 IMC 中也可以添加约束：触发器、修改器，和 IC 中的触发器、修改器会<strong>叠加生效</strong>，下面会详细说明</p>
<ul>
<li><strong>负责将用户的输入映射成输入操作，与按键强相关。</strong></li>
<li>可以根据用户需求动态增减或调整优先级，要用分层、堆栈的思想看待 IMC。</li>
<li>应用场景：某个按钮既可以用来打开场景中的门，又可以用来拾取背包中的道具。</li>
<li>通过 InputMappingContexts，当角色靠近门时，你可以添加 “开门” 这个上下文。假如角色打开背包，你可以添加 “选择道具” 这个输入映射上下文，并且让它的优先级高于 “开门”。</li>
<li>可以通过增强输入本地玩家子系统（Enhanced Input Local Player Subsystem）将一个或多个上下文应用到本地玩家身上，并调整它们的优先级</li>
<li>两种方式屏蔽某个动作：1. 优先级 2. 配 key 不给 Action</li>
</ul>
<p>新建 IMC_Default</p>
<p>空格控制跳跃，AD 控制左右移动，WS 控制前后移动<br><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050022.png" alt="Pasted image 20231204224015"></p>
<p><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050023.png" alt="Pasted image 20231204224109"><br><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050024.png" alt="Pasted image 20231204224125"></p>
<h3 id="角色蓝图"><a href="#角色蓝图" class="headerlink" title="角色蓝图"></a>角色蓝图</h3><p>角色蓝图添加动作映射：</p>
<p>通过 Enhanced Input Local Player Subsystem，将玩家控制器与 IMC 绑定，<strong>绑定后 IMC 能够获取到玩家控制器的输入</strong>。IMC 再根据输入按键匹配 IA ，触发回调。<br>蓝图可以添加多个 IMC，priority 高的起作用<br><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050025.png" alt="Pasted image 20231204224529"><br>蓝图添加按键监听：<br>事件名即 IA 文件名，在 IMC 中一一对应<br><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050026.png" alt="Pasted image 20231204224542"><br><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050027.png" alt="Pasted image 20231204224556"></p>
<p>IA_Move 的输出值是一个二维向量，可以拆分成 x 轴与 y 轴： <code>Action ValueX</code> 、 <code>Action Value Y</code></p>
<p>按键 D 声明获取默认值，输出值为 x&#x3D;1, y&#x3D;0 的二维向量</p>
<p>按键 A 声明获取相反值，输出值为 x&#x3D;-1, y&#x3D;0 的二维向量</p>
<p>按键 W 声明交换输入轴的值，默认的 XYZ，将交换后输出 YXZ，事件回调输出值为 x&#x3D;0, y&#x3D;1 的二维向量</p>
<p>按键 S 声明交换输入轴的相反值，默认的 XYZ，将交换后输出 YXZ，事件回调输出值为 x&#x3D;0, y&#x3D;-1 的二维向量</p>
<p>对于 EnhancedInputAction IA_move 事件而言，它负责监听按键，当按键输入与 IMC 表上声明的按键匹配，事件触发，在回调中返回输出值，输出 IC 中定义好的值。</p>
<p><strong>优化角色移动：</strong><br>上下旋转镜头后，角色移动会变慢，因为角色正前方的向量被分解了<br>所以只获取正前方的向量值</p>
<p><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050028.jpg" alt="bb20d7c7b1e3d6be4fd1d9f2662b0264_MD5"></p>
<p>旋转镜头角色不跟着旋转：</p>
<p><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050029.png" alt="ea15f9b3d47278684df4d423280fdef5_MD5"></p>
<p>use controller rotation yaw 要取消勾选</p>
<p><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050030.png" alt="cbd1edd0b46cd2e696ba290f0d2635b8_MD5"></p>
<h3 id="补充：镜头旋转"><a href="#补充：镜头旋转" class="headerlink" title="补充：镜头旋转"></a>补充：镜头旋转</h3><p>IA_Look:<br><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050031.png" alt="Pasted image 20231204225029"><br>通过 2D 轴值输出 XY 轴向数值</p>
<p>IMC_Default:</p>
<p>Y 轴值取反，使镜头上下旋转的方向与鼠标方向一直<br><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050032.png" alt="Pasted image 20231204225054"><br>角色蓝图，X 轴控制左右旋转，Y 轴控制上下旋转<br><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050033.png" alt="Pasted image 20231204225106"></p>
<p>设置机械臂：<br>允许鼠标进行旋转控制，否则上下旋转不生效<br><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050034.png" alt="Pasted image 20231204225219"></p>
<h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>新建 IA_test 用于测试</p>
<p>IMC:</p>
<p><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050035.jpg" alt="45070408f63daefe72f01a86b4055b56_MD5"></p>
<p>角色蓝图：</p>
<p>查看在事件开始、结束与触发过程中的输出值</p>
<h3 id="InputAction"><a href="#InputAction" class="headerlink" title="InputAction"></a>InputAction</h3><p><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050036.png" alt="Pasted image 20231204225604"><br><code>Cosume Input</code>：这个操作应该吞下绑定到它的任何输入，还是允许它们通过来影响低优先级绑定操作?<br><code>Trigger When Paused</code>：是否可以在游戏暂停时触发<br><code>Reserve All Mappings</code>：此操作的映射不会被高优先级上下文映射自动重载。用户必须首先显式移除映射。注意∶这由映射代码作者负责强制执行!</p>
<h3 id="Value-Type"><a href="#Value-Type" class="headerlink" title="Value Type"></a>Value Type</h3><p><code>Value Type</code>对应事件的返回值类型</p>
<table>
<thead>
<tr>
<th align="left">Value Type &#x2F; Time</th>
<th align="left">Triggered</th>
<th align="left">Started</th>
<th align="left">Ongoing</th>
<th align="left">Canceled</th>
<th align="left">Completed</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Digital (bool)</td>
<td align="left">true</td>
<td align="left">true</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">false</td>
</tr>
<tr>
<td align="left">Axis1D (float)</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">Axis2D (vector2D)</td>
<td align="left">(1,0)</td>
<td align="left">(1,0)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(0,0)</td>
</tr>
<tr>
<td align="left">Axis3D (Vector)</td>
<td align="left">(1,0,0)</td>
<td align="left">(1,0,0)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(0,0,0)</td>
</tr>
</tbody></table>
<h3 id="InputModifier"><a href="#InputModifier" class="headerlink" title="InputModifier"></a>InputModifier</h3><p><strong>调整来自用户设备的原始输入的值</strong></p>
<p><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050037.png" alt="Pasted image 20231204231757"></p>
<ul>
<li><code>Negate</code>：轴值取反</li>
<li><code>SwizzleInputAxisValues</code>：互换轴值，当输入值为两个轴以上的时候，可以将输出值顺序从 XYZ 调整为其他顺序 (比如 XYZ 调整为 YXZ，那么输出的 Vector 值从（x: 1，y: 2，z:3）变为 (x: 2, y: 1, z:3)))，<blockquote>
<p>输出值若为一个轴或 bool 值，将无法获得输出值</p>
</blockquote>
</li>
<li><code>Scalar</code>：缩放</li>
</ul>
<blockquote>
<p>注意：此处对修改器的顺序有要求，对调轴值后，输出值在 Y 轴，此时对 Y 轴进行缩放才有效，否则无效 <img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050038.jpg" alt="341f7a0a2b7e8fb20092c3522e0495c8_MD5"></p>
</blockquote>
<p>其他的修改器有（多与摇杆有关，具体可向 GPT 提问）：</p>
<ul>
<li><code>DeadZone</code>： 限定触发值的范围</li>
<li><code>FOVScaling</code>： FOV 缩放</li>
<li><code>CurveExponential</code>：指数曲线，XYZ</li>
<li><code>CurveUser</code>：自定义指数曲线，CurveFloat</li>
<li><code>Smooth</code>：多帧之间平滑</li>
<li><code>ToWorldSpace</code>：输入设备坐标系向世界坐标系转换</li>
</ul>
<p>当将修改器设置为 ToWorldSpace 时，输入设备的输入值将被转换为世界空间（World Space）中的向量，而不是相对于游戏角色的本地空间（Local Space）中的向量。这意味着，无论游戏角色朝向何方，输入设备的输入值都将产生相同的效果，从而减少了玩家在控制角色时需要考虑本地坐标系的复杂性。</p>
<p>举例来说，如果你将一个摇杆的输入值（X，Y）转换为世界空间中的向量，那么这个向量的方向将与摇杆的偏移方向相同，但是大小将根据摇杆的偏移量来确定。这个向量的大小可以通过修改器的 Scale 属性进行缩放，从而控制游戏角色的移动速度。</p>
<p>需要注意的是，将修改器设置为 ToWorldSpace 可能会对游戏的响应速度产生一定的影响，因为它需要对输入值进行矩阵变换以将其从本地空间转换到世界空间。同时，ToWorldSpace 的效果也可能会因不同的游戏和输入设备而有所不同。</p>
<h3 id="IMC-与-IA-可同时设置-IM、IT"><a href="#IMC-与-IA-可同时设置-IM、IT" class="headerlink" title="IMC 与 IA 可同时设置 IM、IT"></a>IMC 与 IA 可同时设置 IM、IT</h3><p>修改器和触发器可以在 Maping 和 InputAciton 中同时设置：</p>
<ul>
<li><p>Mapping. Modifiers &#x2F; Triggers ：针对当前 IMC 场景，和按键强相关的</p>
</li>
<li><p>InputAction. Modifiers &#x2F; Triggers： 针对全局，不需要关心按键，主要关心值怎么动，处理逻辑相关的，</p>
</li>
<li><p><strong>执行顺序</strong>：先 IMC 后 IC</p>
</li>
</ul>
<h3 id="InputTrigger"><a href="#InputTrigger" class="headerlink" title="InputTrigger"></a>InputTrigger</h3><p><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050039.png" alt="Pasted image 20231204232648"><br>默认使用的是 <code>Down</code> 类型</p>
<ol>
<li>按下：触发 Started</li>
<li>保持：不断触发 Triggered </li>
<li>松开：触发 Completed</li>
</ol>
<ul>
<li><p><code>Down</code>：可用于<strong>机枪的连续射击</strong>，Started 开始射击，Triggered 检查子弹数量，Completed 停止射击，</p>
<ol>
<li>按下：触发 Started </li>
<li>保持：不断触发 Triggered </li>
<li>松开：触发 Completed</li>
</ol>
</li>
<li><p><code>Pressed</code>：</p>
<ol>
<li>按下：依次触发 Started、Triggered 与 Completed</li>
<li>保持：无</li>
<li>松开：无</li>
</ol>
</li>
<li><p><code>Hold</code>：</p>
<ul>
<li><code>Hold Time Threshold</code>：保持多久触发 Triggered 事件</li>
<li><code>Affected by Time Dilation</code>：<code>Hold Time Threshold</code> 是否受全局时间膨胀影响</li>
<li><code>IsOneShot</code>：只触发一次，还是每帧触发?<ol>
<li><strong><code>IsOneShot</code> 没有勾选，每帧触发</strong>：可用于<strong>按下保持一段时间，松开才会触发</strong>的动作。如<strong>吃鸡里手雷投掷</strong>。-<ul>
<li>按下：触发 Started</li>
<li>保持：不断触发 Ongoing，超过 <code>Hold Time Threshold</code> 后不断触发 Triggered</li>
<li>松开：如果保持的时间达到或超过 <code>HoldTimeThreshold</code> 设置的时间则触发 Completed，否则触发 Canceled。</li>
</ul>
</li>
<li><strong><code>IsOneShot</code> 勾选</strong>：用于<strong>按下保持一段时间后自动触发</strong>的动作，如 CS 里<strong>拆包</strong>。</li>
</ol>
<ul>
<li>按下：触发 Started</li>
<li>保持：不断触发 Ongoing</li>
<li>没有达到 <code>HoldTimeThreshold</code> 提前松开：触发 Canceled。</li>
<li>达到 <code>HoldTimeThreshold</code> ：自动依次触发 Triggered 与 Completed。</li>
</ul>
</li>
</ul>
</li>
<li><p><code>Release</code>：</p>
<ol>
<li>按下时触发 Started 事件</li>
<li>保持按下触发 Ongoing 事件</li>
<li>松开时依次触发 Triggered 与 Completed</li>
</ol>
</li>
<li><p><code>HoldAndRelease</code>：</p>
<ol>
<li>按下：触发 Started</li>
<li>保持：不断触发 Ongoing</li>
<li>松开：时如果保持的时间达到 HoldTimeThreshold 设置的时间会依次触发 Triggered 与 Completed，否则触发 Canceled。</li>
</ol>
</li>
<li><p><code>Pulse</code>：用于<strong>保持按下时每隔一段时间触发一次</strong>的动作。如按下吃药键，每隔一段时间执行一次吃药的动作</p>
<ol>
<li>按下：触发 Started 事件</li>
<li>如果勾选 TriggerOnStart 则立即触发一次 Triggered 事件，不勾选则间隔一段时间后触发 Triggered。</li>
<li>保持：触发 Ongoing 事件。</li>
<li>距上一次 Trigger 的时间间隔达到 Interval 设置的时间触发一次 Triggered 事件，随后判断 Trigger 触发的数量是否达到 TriggerLimit 的限制 (TriggerLimit&lt;&#x3D;0 表示不限制次数)，未达到则继续上一步，否则触发 Completed。</li>
</ol>
</li>
<li><p><code>Tap</code> <strong>按下后快速抬起</strong>（默认 0.2）：</p>
<ol>
<li>按下按键触发 Started 事件</li>
<li>保持按下触发 Ongoing 事件</li>
<li>如果保持的时间超过 TapReleaseTimeThreshold 设置的时间触发 Canceled 事件。</li>
<li>松开按键时保持的时间小于 TapReleaseTimeThreshold 设置的时间依次触发 Triggered 与 Completed 事件。</li>
</ol>
</li>
<li><p><code>Chorded Action</code>：用于多个 Action 的串联形成<strong>组合键</strong>。<img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050040.png" alt="Pasted image 20231205001042">按键 1 的 IA 绑定了两个铉操作（按键设置分别为2、3），我们只讨论该 IA 的触发逻辑（绑定的两个铉操作也会执行自己的触发逻辑，这里忽略）<br>  1. 只按  1：无<br>  2. 按 1+2 或 1+3：<br>      - 按下：触发 started<br>      - 保持：触发 Ongoing<br>      - 松开：触发 Canceled<br>  3. 按 1+2+3：<br>      - 按下：触发 started<br>      - 保持：触发 Triggered<br>      - 松开 1：触发 completed<br>      - 松开 2 或 3 其中之一：触发 Ongoing<br>      - 松开 2+3，触发Cancel</p>
</li>
<li><p><code>Combo</code>：用于类似上上下下左右左右 BABA 在短时间内完成的组合键。</p>
<ol>
<li>按下第一个键触发 Started</li>
<li>过程当中不断触发 Ongoing</li>
<li>如果某个键按下的时间没有达到 TimeToPressKey 或者按错键触发 Canceled</li>
<li>当所有的键完成后依次触发 Triggered 与 Completed</li>
</ol>
</li>
</ul>
<p>IT 设置 Combo 后，不需要按键触发，是通过 IC 组合来触发 示例：按下 AABBCC 触发： <img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050041.jpg" alt="696599e5b2744eed75358f0502fb2cd6_MD5"></p>
<h2 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h2><p>命令行输入</p>
<p>showdebug enhancedinput</p>
<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV14r4y1r7nz/">[中文直播]第39期 | 虎跳龙拿–新一代增强输入框架EnhancedInput | Epic 大钊_哔哩哔哩_bilibili</a></p>
<p><strong>IMC BindAction</strong></p>
<ul>
<li>初始情况应该在哪里开始应用 IMC</li>
<li>后续运行时在蓝图中如何切换 IMC</li>
<li>何时 Remove IMC</li>
<li>在哪里绑定 Action 和 Axis</li>
<li>在蓝图中如何 BindAction</li>
</ul>
<h3 id="5-1-初始情况应该在哪里开始应用-IMC"><a href="#5-1-初始情况应该在哪里开始应用-IMC" class="headerlink" title="5.1 初始情况应该在哪里开始应用 IMC"></a>5.1 初始情况应该在哪里开始应用 IMC</h3><p><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050042.jpg" alt="a93e70713bed461536d8637dfab3cc72_MD5"> <img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050043.jpg" alt="8d7093faf0d99c274fe21061608f806e_MD5"></p>
<h3 id="5-2-何时-Remove-IMC"><a href="#5-2-何时-Remove-IMC" class="headerlink" title="5.2 何时 Remove IMC"></a>5.2 何时 Remove IMC</h3><p><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050044.jpg" alt="2ceac629710a76ed056109a05fdafff3_MD5"></p>
<h3 id="5-3-IMC-BindAction-最佳实践"><a href="#5-3-IMC-BindAction-最佳实践" class="headerlink" title="5.3 IMC BindAction 最佳实践"></a>5.3 IMC BindAction 最佳实践</h3><p><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050045.jpg" alt="9a07fc2e0aa7f362e823dd4dbc51521c_MD5"></p>
<h3 id="5-4-Debug"><a href="#5-4-Debug" class="headerlink" title="5.4 Debug"></a>5.4 Debug</h3><p><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050046.jpg" alt="fdb5047e04e6bdb5906ca5db58b6d52c_MD5"></p>
<h1 id="默认输入系统"><a href="#默认输入系统" class="headerlink" title="默认输入系统"></a>默认输入系统</h1><h3 id="轴映射与动作映射"><a href="#轴映射与动作映射" class="headerlink" title="轴映射与动作映射"></a>轴映射与动作映射</h3><p>轴映射每帧执行，动作映射一次性执行 <img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050047.png" alt="Pasted image 20230904135119"> <img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050048.png" alt="Pasted image 20230904204143"> <img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202408080050049.png" alt="c89952d2bf5eee78e9a758b738322967_MD5"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">AMyCharacter::SetupPlayerInputComponent</span><span class="params">(UInputComponent* PlayerInputComponent)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    Super::<span class="built_in">SetupPlayerInputComponent</span>(PlayerInputComponent);  </span><br><span class="line">​  </span><br><span class="line">    PlayerInputComponent-&gt;<span class="built_in">BindAction</span>(<span class="string">&quot;DropItem&quot;</span>, EInputEvent::IE_Pressed, <span class="keyword">this</span>, &amp;AMyCharacter::DropItem);  </span><br><span class="line">    PlayerInputComponent-&gt;<span class="built_in">BindAction</span>(<span class="string">&quot;Jump&quot;</span>, IE_Pressed, <span class="keyword">this</span>, &amp;AMyCharacter::Jump);  </span><br><span class="line">    PlayerInputComponent-&gt;<span class="built_in">BindAxis</span>(<span class="string">&quot;MoveForward&quot;</span>, <span class="keyword">this</span>, &amp;AMyCharacter::MoveForward);  </span><br><span class="line">    PlayerInputComponent-&gt;<span class="built_in">BindAxis</span>(<span class="string">&quot;MoveRight&quot;</span>, <span class="keyword">this</span>, &amp;AMyCharacter::MoveRight);  </span><br><span class="line">    PlayerInputComponent-&gt;<span class="built_in">BindAxis</span>(<span class="string">&quot;PitchCamera&quot;</span>, <span class="keyword">this</span>, &amp;AMyCharacter::PitchCamera);  </span><br><span class="line">    PlayerInputComponent-&gt;<span class="built_in">BindAxis</span>(<span class="string">&quot;YawCamera&quot;</span>, <span class="keyword">this</span>, &amp;AMyCharacter::YawCamera);  </span><br><span class="line">&#125;  </span><br><span class="line">​  </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AMyCharacter::MoveForward</span><span class="params">(<span class="type">float</span> AxisValue)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    MovementInput.X = FMath::<span class="built_in">Clamp</span>&lt;<span class="type">float</span>&gt;(AxisValue, <span class="number">-1.f</span>, <span class="number">1.f</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">​  </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AMyCharacter::MoveRight</span><span class="params">(<span class="type">float</span> AxisValue)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    MovementInput.Y = FMath::<span class="built_in">Clamp</span>&lt;<span class="type">float</span>&gt;(AxisValue, <span class="number">-1.f</span>, <span class="number">1.f</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">​  </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AMyCharacter::PitchCamera</span><span class="params">(<span class="type">float</span> AxisValue)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    CameraInput.Y = AxisValue;  </span><br><span class="line">&#125;  </span><br><span class="line">​  </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AMyCharacter::YawCamera</span><span class="params">(<span class="type">float</span> AxisValue)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    CameraInput.X = AxisValue;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>设置按键再游戏暂停可以继续响应 <code>bExecuteWhenPaused</code></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InputComponent-&gt;<span class="built_in">BindAction</span>(<span class="string">&quot;ESCEvent&quot;</span>, IE_Pressed, <span class="keyword">this</span>, &amp;ASLAiPlayerController::ESCEvent).bExecuteWhenPaused=<span class="literal">true</span>;<span class="comment">//游戏暂停可以执行</span></span><br></pre></td></tr></table></figure>
<h3 id="从C-中添加轴和动作映射"><a href="#从C-中添加轴和动作映射" class="headerlink" title="从C++中添加轴和动作映射"></a>从C++中添加轴和动作映射</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加、绑定ActionKeyMapping轴映射 方法一  </span></span><br><span class="line"><span class="function">FInputActionKeyMapping <span class="title">onFire</span><span class="params">(<span class="string">&quot;OnFire&quot;</span>, EKeys::LeftMouseButton, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span></span>;  </span><br><span class="line">UPlayerInput::<span class="built_in">AddEngineDefinedActionMapping</span>(onFire);  </span><br><span class="line">PlayerInputComponent-&gt;<span class="built_in">BindAction</span>(<span class="string">&quot;OnFire&quot;</span>, IE_Pressed, <span class="keyword">this</span>, &amp;AMyCharacter::OnFire);  </span><br><span class="line">​  </span><br><span class="line"><span class="comment">//添加、绑定ActionKeyMapping轴映射 方法二  </span></span><br><span class="line">UPlayerInput::<span class="built_in">AddEngineDefinedActionMapping</span>(<span class="built_in">FInputActionKeyMapping</span>(<span class="string">&quot;Sprint&quot;</span>,EKeys::LeftShift));  </span><br><span class="line">PlayerInputComponent-&gt;<span class="built_in">BindAction</span>(<span class="string">&quot;Sprint&quot;</span>, IE_Pressed,<span class="keyword">this</span>,&amp;AMyCharacter::StartSprint);  </span><br><span class="line">PlayerInputComponent-&gt;<span class="built_in">BindAction</span>(<span class="string">&quot;Sprint&quot;</span>, IE_Released,<span class="keyword">this</span>,&amp;AMyCharacter::StopSprint);  </span><br><span class="line">​  </span><br><span class="line"><span class="comment">//添加、绑定AxisMapping轴映射  </span></span><br><span class="line">UPlayerInput::<span class="built_in">AddEngineDefinedAxisMapping</span>(<span class="built_in">FInputAxisKeyMapping</span>(<span class="string">&quot;Turn&quot;</span>, EKeys::MouseX, <span class="number">1.0f</span>));  </span><br><span class="line">PlayerInputComponent-&gt;<span class="built_in">BindAxis</span>(<span class="string">&quot;Turn&quot;</span>, <span class="keyword">this</span>, &amp;AMyCharacter::OnTurn);  </span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://liuke101.github.io">灵玉</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://liuke101.github.io/post/28207.html">http://liuke101.github.io/post/28207.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://liuke101.github.io" target="_blank">游戏江湖</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/UEC/">UEC++</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/I168.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdmirror.com/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赏碎银二两</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202404232247905.jpg" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202404232247905.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202404232251074.jpg" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202404232251074.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/8996.html" title="UEC++定时器"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">UEC++定时器</div></div></a></div><div class="next-post pull-right"><a href="/post/28208.html" title="UE伤害系统"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">UE伤害系统</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/28208.html" title="UE伤害系统"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-16</div><div class="title">UE伤害系统</div></div></a></div><div><a href="/post/33399.html" title="UEC++委托"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-14</div><div class="title">UEC++委托</div></div></a></div><div><a href="/post/8996.html" title="UEC++定时器"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-16</div><div class="title">UEC++定时器</div></div></a></div><div><a href="/post/40918.html" title="UEC++基础API"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-16</div><div class="title">UEC++基础API</div></div></a></div><div><a href="/post/3180.html" title="UEC++指针"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-08</div><div class="title">UEC++指针</div></div></a></div><div><a href="/post/19081.html" title="UEC++容器"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-12</div><div class="title">UEC++容器</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="comment-switch"><span class="first-comment">Waline</span><span id="switch-btn"></span><span class="second-comment">Livere</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div><div><div id="lv-container" data-id="city" data-uid="MTAyMC81OTc3Ny8zNjIzOQ=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/I168.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">灵玉</div><div class="author-info__description">游戏开发</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">78</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/liuke101"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/liuke101" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="/gamerlk@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">1. 如图片加载缓慢请使用VPN。 2. 文章摘自个人obsidian笔记，存在部分md语法冲突，导致显示异常，暂未完全修复。 3. 文章部分内容参考/引用网络资源，用于个人学习，如有侵权，请联系我删除。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A2%9E%E5%BC%BA%E8%BE%93%E5%85%A5"><span class="toc-text">增强输入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%93%9D%E5%9B%BE%E4%B8%8E-C-%E5%AE%9E%E7%8E%B0"><span class="toc-text">蓝图与 C++实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-InputAction"><span class="toc-text">创建 InputAction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-InputMappingContext"><span class="toc-text">创建 InputMappingContext</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%BE%93%E5%85%A5%E6%98%A0%E5%B0%84%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-text">添加输入映射上下文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-InputAction-%E4%BA%8B%E4%BB%B6"><span class="toc-text">使用 InputAction 事件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A2%9E%E5%BC%BA%E8%BE%93%E5%85%A5%E7%94%A8%E6%B3%95%EF%BC%9A%E6%8E%A7%E5%88%B6%E8%A7%92%E8%89%B2%E8%B7%B3%E8%B7%83%E4%B8%8E%E7%A7%BB%E5%8A%A8"><span class="toc-text">增强输入用法：控制角色跳跃与移动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Input-Action"><span class="toc-text">Input Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Input-Mapping-Context-IMC"><span class="toc-text">Input Mapping Context (IMC)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E8%93%9D%E5%9B%BE"><span class="toc-text">角色蓝图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%EF%BC%9A%E9%95%9C%E5%A4%B4%E6%97%8B%E8%BD%AC"><span class="toc-text">补充：镜头旋转</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90"><span class="toc-text">解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#InputAction"><span class="toc-text">InputAction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Value-Type"><span class="toc-text">Value Type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#InputModifier"><span class="toc-text">InputModifier</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IMC-%E4%B8%8E-IA-%E5%8F%AF%E5%90%8C%E6%97%B6%E8%AE%BE%E7%BD%AE-IM%E3%80%81IT"><span class="toc-text">IMC 与 IA 可同时设置 IM、IT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#InputTrigger"><span class="toc-text">InputTrigger</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Debug"><span class="toc-text">Debug</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-text">最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%88%9D%E5%A7%8B%E6%83%85%E5%86%B5%E5%BA%94%E8%AF%A5%E5%9C%A8%E5%93%AA%E9%87%8C%E5%BC%80%E5%A7%8B%E5%BA%94%E7%94%A8-IMC"><span class="toc-text">5.1 初始情况应该在哪里开始应用 IMC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E4%BD%95%E6%97%B6-Remove-IMC"><span class="toc-text">5.2 何时 Remove IMC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-IMC-BindAction-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-text">5.3 IMC BindAction 最佳实践</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-Debug"><span class="toc-text">5.4 Debug</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E8%BE%93%E5%85%A5%E7%B3%BB%E7%BB%9F"><span class="toc-text">默认输入系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%B4%E6%98%A0%E5%B0%84%E4%B8%8E%E5%8A%A8%E4%BD%9C%E6%98%A0%E5%B0%84"><span class="toc-text">轴映射与动作映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8EC-%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%BD%B4%E5%92%8C%E5%8A%A8%E4%BD%9C%E6%98%A0%E5%B0%84"><span class="toc-text">从C++中添加轴和动作映射</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/33227.html" title="《仓鼠球！GO!》">《仓鼠球！GO!》</a><time datetime="2024-08-17T16:00:00.000Z" title="发表于 2024-08-18 00:00:00">2024-08-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/3834.html" title="Effective Modern C++">Effective Modern C++</a><time datetime="2024-01-18T04:20:00.000Z" title="发表于 2024-01-18 12:20:00">2024-01-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/57053.html" title="Lua精粹">Lua精粹</a><time datetime="2023-10-28T16:00:00.000Z" title="发表于 2023-10-29 00:00:00">2023-10-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/46644.html" title="UE AI系统">UE AI系统</a><time datetime="2023-10-15T16:00:00.000Z" title="发表于 2023-10-16 00:00:00">2023-10-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/46645.html" title="GAS精粹">GAS精粹</a><time datetime="2023-10-15T16:00:00.000Z" title="发表于 2023-10-16 00:00:00">2023-10-16</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdmirror.com/gh/liuke101/PicGo-For-Hexo/image/202404232157234.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 By 灵玉</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdmirror.com/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdmirror.com/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdmirror.com/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdmirror.com/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  let initFn = window.walineFn || null

  const initWaline = (Fn) => {
    const waline = Fn(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://waline-server-indol.vercel.app/',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: true,
    }, null))

    const destroyWaline = () => {
      waline.destroy()
    }

    btf.addGlobalFn('pjax', destroyWaline, 'destroyWaline')
  }

  const loadWaline = async () => {
    if (initFn) initWaline(initFn)
    else {
      await getCSS('https://cdn.jsdmirror.com/npm/@waline/client@3.1.2/dist/waline.min.css')
      const { init } = await import('https://cdn.jsdmirror.com/npm/@waline/client@3.1.2/dist/waline.min.js')
      initFn = init || Waline.init
      initWaline(initFn)
      window.walineFn = initFn
    }
  }

  if ('Waline' === 'Waline' || !false) {
    if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><script>(()=>{
  const loadLivere = () => {
    if (typeof LivereTower === 'object') window.LivereTower.init()
    else {
      (function(d, s) {
          var j, e = d.getElementsByTagName(s)[0];
          if (typeof LivereTower === 'function') { return; }
          j = d.createElement(s);
          j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
          j.async = true;
          e.parentNode.insertBefore(j, e);
      })(document, 'script');
    }
  }

  if ('Waline' === 'Livere' || !false) {
    if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
    else loadLivere()
  } else {
    window.loadOtherComment = loadLivere
  }
})()</script></div><script>window.addEventListener('load', () => {
  const changeContent = content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = async () => {
    try {
      const res = await fetch('https://waline-server-indol.vercel.app/api/comment?type=recent&count=6', { method: 'GET' })
      const result = await res.json()
      const walineArray = result.data.map(e => {
        return {
          'content': changeContent(e.comment),
          'avatar': e.avatar,
          'nick': e.nick,
          'url': e.url + '#' + e.objectId,
          'date': e.time || e.insertedAt
        }
      })
      saveToLocal.set('waline-newest-comments', JSON.stringify(walineArray), 10/(60*24))
      generateHtml(walineArray)
    } catch (err) {
      console.error(err)
      const $dom = document.querySelector('#card-newest-comments .aside-list')
      $dom.textContent= "无法获取评论，请确认相关配置是否正确"
    }
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('waline-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><div class="aplayer no-destroy" data-id="9896988395" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><link rel="stylesheet" href="https://cdn.jsdmirror.com/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdmirror.com/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdmirror.com/npm/butterfly-extsrc@1.1.3/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdmirror.com/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdmirror.com/npm/algoliasearch@4.22.1/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdmirror.com/npm/instantsearch.js@4.65.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js?v=4.13.0"></script></div></div></body></html>