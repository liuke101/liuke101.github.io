<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Unity数据持久化 | 游戏江湖</title><meta name="author" content="灵玉"><meta name="copyright" content="灵玉"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="什么是数据持久化？数据持久化就是将内存中的数据模型转换为存储模型, 以及将存储模型转换为内存中的数据模型的统称说人话: 将游戏数据存储到硬盘，硬盘中数据读取到游戏中，也就是传统意义上的存盘。 如何理解不同后缀的文件?文件后缀名决定了文件的格式不同的软件可以根据后缀名用来判断文件的类型并且在打开文件时以特定的读取规则去解析它文件后缀名是人为定的规则可以有无数种，可以自定义 Playerprefs基本">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity数据持久化">
<meta property="og:url" content="http://liuke101.github.io/post/62114.html">
<meta property="og:site_name" content="游戏江湖">
<meta property="og:description" content="什么是数据持久化？数据持久化就是将内存中的数据模型转换为存储模型, 以及将存储模型转换为内存中的数据模型的统称说人话: 将游戏数据存储到硬盘，硬盘中数据读取到游戏中，也就是传统意义上的存盘。 如何理解不同后缀的文件?文件后缀名决定了文件的格式不同的软件可以根据后缀名用来判断文件的类型并且在打开文件时以特定的读取规则去解析它文件后缀名是人为定的规则可以有无数种，可以自定义 Playerprefs基本">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190020794.png">
<meta property="article:published_time" content="2024-05-18T16:26:43.000Z">
<meta property="article:modified_time" content="2024-05-18T16:27:18.923Z">
<meta property="article:author" content="灵玉">
<meta property="article:tag" content="Unity">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190020794.png"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202404232138939.png"><link rel="canonical" href="http://liuke101.github.io/post/62114.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="6wt4eQbcmYIioyaSsUswEjImObRq1GoUZP_ZRoEoOXc"/><meta name="msvalidate.01" content="9315C074B7CC1C8996DDD5A9533EF368"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?1d08ce745bb272195666f030857b5f8b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"QTHLKKVLAS","apiKey":"7f01e97a350ca196bda1df9cd9168b30","indexName":"hexo","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 灵玉","link":"链接: ","source":"来源: 游戏江湖","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#804bfb","bgDark":"#804bfb","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Unity数据持久化',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-19 00:27:18'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/I168.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">48</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190020794.png')"><nav id="nav"><span id="blog-info"><a href="/" title="游戏江湖"><span class="site-name">游戏江湖</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Unity数据持久化</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-05-18T16:26:43.000Z" title="发表于 2024-05-19 00:26:43">2024-05-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-05-18T16:27:18.923Z" title="更新于 2024-05-19 00:27:18">2024-05-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Unity/">Unity</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>53分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Unity数据持久化"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/post/62114.html#post-comment"><span class="waline-comment-count" data-path="/post/62114.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019886.png" alt="Pasted image 20230611210946"><br><strong>什么是数据持久化？</strong><br>数据持久化就是将内存中的数据模型转换为存储模型, 以及将存储模型转换为内存中的数据模型的统称<br>说人话: <strong>将游戏数据存储到硬盘，硬盘中数据读取到游戏中，也就是传统意义上的存盘。</strong></p>
<p><strong>如何理解不同后缀的文件?</strong><br>文件后缀名决定了文件的格式<br>不同的软件可以根据后缀名用来判断文件的类型并且在打开文件时以特定的读取规则去解析它<br>文件后缀名是人为定的规则可以有无数种，可以自定义</p>
<h1 id="Playerprefs"><a href="#Playerprefs" class="headerlink" title="Playerprefs"></a>Playerprefs</h1><h2 id="基本方法"><a href="#基本方法" class="headerlink" title="基本方法"></a>基本方法</h2><p>prefs：控制台</p>
<ul>
<li>Playerprefs 是 unity 提供的可以用于<strong>存储读取玩家数据的公共类</strong></li>
<li>PlayerPrefs 的数据存储类似于<strong>键值对</strong>存储，一个键对应一个值<ul>
<li>提供了存储 3 种数据的方法：int float string</li>
<li>键：string 类型</li>
<li>值：int float string  对应 3 种 API</li>
</ul>
</li>
<li>如果不同类型用同一键名进行存储，会覆盖数据</li>
</ul>
<blockquote>
<p>[!NOTE] 数据的唯一性<br>PlayerPrefs 中不同数据的唯一性是由 key 决定的，不同的 key 决定了不同的数据，同一项目中如果不同数据 key 相同，会造成数据丢失要保证数据不丢失，就要建立一个保证 key 唯一的规则。</p>
</blockquote>
<figure class="highlight cs"><figcaption><span>title:存储数据</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接调用set相关方法只会把数据存到内存里</span></span><br><span class="line"><span class="comment">//当游戏结束时 Unity会自动把数据存到硬盘中</span></span><br><span class="line">PlayerPrefs.SetInt(<span class="string">&quot;myAge&quot;</span>,<span class="number">18</span>);  </span><br><span class="line">PlayerPrefs.SetFloat(<span class="string">&quot;myHeight&quot;</span>,<span class="number">1.75f</span>);</span><br><span class="line">PlayerPrefs.SetString(<span class="string">&quot;myName&quot;</span>,<span class="string">&quot;张三&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果游戏不是正常结束的，而是崩溃，数据是不会存到硬盘中的</span></span><br><span class="line"><span class="comment">//可以调用save方法手动把数据存到硬盘中</span></span><br><span class="line">PlayerPrefs.Save();</span><br></pre></td></tr></table></figure>

<p><strong>注意运行时只要你 set 了对应键值对，即使你没有马上存储 save 在本地，也能够读取出信息</strong></p>
<figure class="highlight cs"><figcaption><span>title:读取数据</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> age = PlayerPrefs.GetInt(<span class="string">&quot;myAge&quot;</span>,<span class="number">20</span>); <span class="comment">//可选第二参数，如果找不到myAge的值，就会返回第二个参数   </span></span><br><span class="line"><span class="built_in">float</span> height = PlayerPrefs.GetFloat(<span class="string">&quot;myHeight&quot;</span>);</span><br><span class="line"><span class="built_in">string</span> name = PlayerPrefs.GetString(<span class="string">&quot;myName&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight cs"><figcaption><span>title:判断数据是否存在</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(PlayerPrefs.HasKey(<span class="string">&quot;myAge&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">&quot;myAge存在&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cs"><figcaption><span>title:删除数据</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除单个数据</span></span><br><span class="line">PlayerPrefs.DeleteKey(<span class="string">&quot;MyAge&quot;</span>);</span><br><span class="line"><span class="comment">//删除所有存储的数据</span></span><br><span class="line">PlayerPrefs.DeleteAll();</span><br></pre></td></tr></table></figure>

<h2 id="存储其他类型"><a href="#存储其他类型" class="headerlink" title="存储其他类型"></a>存储其他类型</h2><p>PlayerPrefs 是有局限性的它只能存 3 种类型的数据，如果你想要存储别的类型的数据只能降低精度或者上升精度来进行存储，当然也可采用下面的小 trick：</p>
<figure class="highlight cs"><figcaption><span>title:trick存储bool类型</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> sex = <span class="literal">true</span>;</span><br><span class="line">PlayerPrefs.SetInt( <span class="string">&quot;sex&quot;</span>, sex ? <span class="number">1</span> : <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p><strong>存储更复杂的 List&lt;&gt; 类型</strong></p>
<figure class="highlight cs"><figcaption><span>title:存储更复杂的List<>类型</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Player</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> _age;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> _atk;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> _def;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//装备信息</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Equipment&gt; EquipmentsList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//该变量时一个存储和读取的唯一key标识。识别多个玩家，分别存储</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> _keyName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Save</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        PlayerPrefs.SetString(_keyName + <span class="string">&quot;name&quot;</span>, _name);</span><br><span class="line">        PlayerPrefs.SetInt(_keyName + <span class="string">&quot;age&quot;</span>, _age);</span><br><span class="line">        PlayerPrefs.SetInt(_keyName + <span class="string">&quot;atk&quot;</span>, _atk);</span><br><span class="line">        PlayerPrefs.SetInt(_keyName + <span class="string">&quot;def&quot;</span>, _def);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//装备信息</span></span><br><span class="line">        PlayerPrefs.SetInt(<span class="string">&quot;EquipmentsCount&quot;</span>, EquipmentsList.Count);</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; EquipmentsList.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//存储每一个装备的id和数量</span></span><br><span class="line">            PlayerPrefs.SetInt(<span class="string">&quot;EquipmentsID&quot;</span> + i, EquipmentsList[i]._id);</span><br><span class="line">            PlayerPrefs.SetInt(<span class="string">&quot;EquipmentsCount&quot;</span> + i, EquipmentsList[i]._count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Load</span>(<span class="params"><span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>._keyName = keyName; </span><br><span class="line">        </span><br><span class="line">        _name = PlayerPrefs.GetString(keyName + <span class="string">&quot;name&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">        _age = PlayerPrefs.GetInt(keyName + <span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        _atk = PlayerPrefs.GetInt(keyName + <span class="string">&quot;atk&quot;</span>, <span class="number">100</span>);</span><br><span class="line">        _def = PlayerPrefs.GetInt(keyName + <span class="string">&quot;def&quot;</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//装备信息</span></span><br><span class="line">        <span class="built_in">int</span> num = PlayerPrefs.GetInt(<span class="string">&quot;EquipmentsCount&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        EquipmentsList = <span class="keyword">new</span> List&lt;Equipment&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Equipment equipment = <span class="keyword">new</span> Equipment();</span><br><span class="line">            equipment._id = PlayerPrefs.GetInt(<span class="string">&quot;EquipmentsID&quot;</span> + i, <span class="number">0</span>);</span><br><span class="line">            equipment._count = PlayerPrefs.GetInt(<span class="string">&quot;EquipmentsCount&quot;</span> + i, <span class="number">0</span>);</span><br><span class="line">            EquipmentsList.Add(equipment);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Equipment</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> _id;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> _count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NewBehaviourScript1</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Player player1 = <span class="keyword">new</span> Player();</span><br><span class="line">        player1.Load(<span class="string">&quot;Player1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        print(<span class="string">&quot;装备列表数量：&quot;</span> + player1.EquipmentsList.Count);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; player1.EquipmentsList.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            print(<span class="string">&quot;道具ID：&quot;</span> + player1.EquipmentsList[i]._id);</span><br><span class="line">            print(<span class="string">&quot;道具数量：&quot;</span> + player1.EquipmentsList[i]._count);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Equipment equipment1 = <span class="keyword">new</span> Equipment();</span><br><span class="line">        equipment1._id = <span class="number">1</span>;</span><br><span class="line">        equipment1._count = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        Equipment equipment2 = <span class="keyword">new</span> Equipment();</span><br><span class="line">        equipment2._id = <span class="number">2</span>;</span><br><span class="line">        equipment2._count = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        player1.EquipmentsList.Add(equipment1);</span><br><span class="line">        player1.EquipmentsList.Add(equipment2);</span><br><span class="line"></span><br><span class="line">        player1.Save();</span><br><span class="line"></span><br><span class="line">        print(<span class="string">&quot;装备列表数量：&quot;</span> + player1.EquipmentsList.Count);</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; player1.EquipmentsList.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            print(<span class="string">&quot;道具ID：&quot;</span> + player1.EquipmentsList[i]._id);</span><br><span class="line">            print(<span class="string">&quot;道具数量：&quot;</span> + player1.EquipmentsList[i]._count);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Player player2 = <span class="keyword">new</span> Player();</span><br><span class="line">        player2.Load(<span class="string">&quot;Player2&quot;</span>);</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        player2.Save();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="存储位置"><a href="#存储位置" class="headerlink" title="存储位置"></a>存储位置</h2><p>不同平台存储位置不同<br><strong>Win</strong><br>存储在 <code>HKCU\Software\[公司名称]\[产品名称]</code> 项下的注册表中<br>其中公司和产品名称是在“Project settings”中设置的名称。 </p>
<ol>
<li>运行 regedit</li>
<li><code>HKEY_CURRENT_USER/SOFTWARE/Unity/UnityEditor/</code>公司名称&#x2F;产品名称<br><strong>安卓</strong><br><code>/data/ data/包名/shared_prefs/pkg-name .xml</code></li>
</ol>
<p><strong>IOS</strong><br><code>/Librany/Preferences/[应用 ID]. plist</code></p>
<p>单独使用它的原生功能，非常适合存储一些对安全性要求不高的简单数据<br>但是也不能小看它，对它进行简单的封装，也可以让它变得方便又安全</p>
<h2 id="Playerprefs-数据管理类"><a href="#Playerprefs-数据管理类" class="headerlink" title="Playerprefs 数据管理类"></a>Playerprefs 数据管理类</h2><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 数据管理类提供给外部的方法：</span></span><br><span class="line"><span class="comment"> * 1. 存储数据</span></span><br><span class="line"><span class="comment"> * 2. 读取数据</span></span><br><span class="line"><span class="comment"> * 3. 外部可以传入数据直接进行存储</span></span><br><span class="line"><span class="comment"> * 4. 外部可以传入数据类型直接进行数据获取</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"><span class="keyword">using</span> Unity.VisualScripting;</span><br><span class="line"><span class="keyword">using</span> Unity.VisualScripting.FullSerializer;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> PlayerPrefs数据管理类，统一管理数据的存储和读取</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerPrefsDataManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//单例模式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> PlayerPrefsDataManager instance = <span class="keyword">new</span> PlayerPrefsDataManager();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PlayerPrefsDataManager Instance</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> instance; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">PlayerPrefsDataManager</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 存储数据</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;data&quot;&gt;</span>数据对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;keyName&quot;&gt;</span>数据对象的唯一性key，自己控制<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SaveData</span>(<span class="params"><span class="built_in">object</span> data, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//就是要通过Type得到传入数据对象的所有的字段</span></span><br><span class="line">        <span class="comment">//然后结合aYerPrefs来进行存储</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 第一步：获取传入数据对象的所有字段</span></span><br><span class="line"></span><br><span class="line">        Type dataType = data.GetType();</span><br><span class="line">        <span class="comment">//得到所有字段</span></span><br><span class="line">        FieldInfo[] fieldInfos = dataType.GetFields();</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 第二步：自己定义一个key的规则，进行数据存储</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//我们存储都是通过PlayerPrefs来进行存储的</span></span><br><span class="line">        <span class="comment">//保证key的唯一性我们就需要自己定一个key的规则</span></span><br><span class="line">        <span class="comment">//key的规则：keyName_数据类型_字段类型_字段名</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 第三步：遍历这些字段，进行数据存储</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> saveKeyName = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        FieldInfo info;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; fieldInfos.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//对每一个字段，进行数据存储</span></span><br><span class="line">            <span class="comment">//得到具体的字段信息</span></span><br><span class="line">            info = fieldInfos[i];</span><br><span class="line">            <span class="comment">//通过FieldInfo可以直接获取到字段的类型和字段的名字</span></span><br><span class="line">            saveKeyName = keyName + <span class="string">&quot;_&quot;</span> + dataType.Name + <span class="string">&quot;_&quot;</span> + info.FieldType + <span class="string">&quot;_&quot;</span> + info.Name;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//现在得到了Key按照我们的规则</span></span><br><span class="line">            <span class="comment">//接下来就要来通过PlayerPrefs来进行存储</span></span><br><span class="line">            SaveValue(info.GetValue(data), saveKeyName);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        PlayerPrefs.Save();</span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 存储值</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;value&quot;&gt;</span>数据对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;saveKeyName&quot;&gt;</span>数据对象的唯一性key<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SaveValue</span>(<span class="params"><span class="built_in">object</span> <span class="keyword">value</span>, <span class="built_in">string</span> saveKeyName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//直接通过PlayerPrefs来进行存储了</span></span><br><span class="line">        <span class="comment">//就是根据数据类型的不同来决定使用哪一个API来进行存储</span></span><br><span class="line">        <span class="comment">//PlayerPrefs只支持3种类型存储</span></span><br><span class="line">        <span class="comment">//判断数据类型是什么类型 然后调用具体的方法来存储</span></span><br><span class="line">        Type fieldType = <span class="keyword">value</span>.GetType();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//int,float,string类型存储</span></span><br><span class="line">        <span class="comment">//类型判断</span></span><br><span class="line">        <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">int</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            PlayerPrefs.SetInt(saveKeyName, (<span class="built_in">int</span>)<span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">float</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            PlayerPrefs.SetFloat(saveKeyName, (<span class="built_in">float</span>)<span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">string</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            PlayerPrefs.SetString(saveKeyName, <span class="keyword">value</span>.ToString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">bool</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//自己顶一个存储bool的规则</span></span><br><span class="line">            PlayerPrefs.SetInt(saveKeyName, (<span class="built_in">bool</span>)<span class="keyword">value</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//List&lt;T&gt;类型存储</span></span><br><span class="line">        <span class="comment">//如何判断泛型类的类型？比如List&lt;T&gt;</span></span><br><span class="line">        <span class="comment">//通过反射判断父子关系</span></span><br><span class="line">        <span class="comment">//这相当于判断字段是不是IList的子类</span></span><br><span class="line">        <span class="comment">//为什么想到IList，可以通过List查看他的父类，IList是List的父类，因此可以用父类装子类</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(IList).IsAssignableFrom(fieldType))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//父类装子类</span></span><br><span class="line">            IList list = <span class="keyword">value</span> <span class="keyword">as</span> IList;</span><br><span class="line">            <span class="comment">//先存储数量</span></span><br><span class="line">            PlayerPrefs.SetInt(saveKeyName, list.Count);</span><br><span class="line">            <span class="built_in">int</span> index = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="built_in">object</span> obj <span class="keyword">in</span> list)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//存储具体的值</span></span><br><span class="line">                SaveValue(obj, saveKeyName + index); <span class="comment">//递归！</span></span><br><span class="line">                ++index;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Dictionary&lt;T&gt;类型存储</span></span><br><span class="line">        <span class="comment">//同理，IDictionary是Dictionary的父类</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(IList).IsAssignableFrom(fieldType))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//父类装子类</span></span><br><span class="line">            IDictionary dictionary = <span class="keyword">value</span> <span class="keyword">as</span> IDictionary;</span><br><span class="line">            <span class="comment">//先存储字典长度</span></span><br><span class="line">            PlayerPrefs.SetInt(saveKeyName, dictionary.Count);</span><br><span class="line">            <span class="comment">//遍历存储字典里面的具体值</span></span><br><span class="line">            <span class="built_in">int</span> index = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="built_in">object</span> key <span class="keyword">in</span> dictionary.Keys)</span><br><span class="line">            &#123;</span><br><span class="line">                SaveValue(key, saveKeyName + <span class="string">&quot;_key_&quot;</span> + index); <span class="comment">//递归！</span></span><br><span class="line">                SaveValue(dictionary[key], saveKeyName + <span class="string">&quot;_value_&quot;</span> + index);</span><br><span class="line">                ++index;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//存储自定义类类型</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            SavaData(<span class="keyword">value</span>, saveKeyName); <span class="comment">//递归</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 读取数据</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;type&quot;&gt;</span>想要读取数据的数据类型<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;keyName&quot;&gt;</span>数据对象的唯一性key，自己控制<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">LoadData</span>(<span class="params">Type type, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//不用object对象传入 而使用Type传入的原因是:</span></span><br><span class="line">        <span class="comment">//object对象传入的话，必须在外部new一个对象传入</span></span><br><span class="line">        <span class="comment">//而Type传入的话，只需要一个Type typeof(Player)，就可以直接使用Activator.CreateInstance(type)来创建对象</span></span><br><span class="line">        <span class="comment">//这样可以少写一行代码</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据你传入的类型和keyName</span></span><br><span class="line">        <span class="comment">//依据你存储数据时key的拼接规则来进行数据的获取赋值返回出去</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据传入的Type 创建一个对象用于存储数据</span></span><br><span class="line">        <span class="built_in">object</span> data = Activator.CreateInstance(type);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//要往这个new出来的对象中填充数据</span></span><br><span class="line">        <span class="comment">//得到所有字段</span></span><br><span class="line">        FieldInfo[] fieldInfos = type.GetFields();</span><br><span class="line">        <span class="comment">//用于拼接key的字符串</span></span><br><span class="line">        <span class="built_in">string</span> saveKeyName = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        FieldInfo info;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; fieldInfos.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            info = fieldInfos[i];</span><br><span class="line">            <span class="comment">//key的拼接规则，一定和存储时一模一样</span></span><br><span class="line">            saveKeyName = keyName + <span class="string">&quot;_&quot;</span> + type.Name + <span class="string">&quot;_&quot;</span> + info.FieldType + <span class="string">&quot;_&quot;</span> + info.Name;</span><br><span class="line">            <span class="comment">//有key就可以结合Playerprefs来读取数据</span></span><br><span class="line">            <span class="comment">//填充数据到data中</span></span><br><span class="line">            info.SetValue(data, LoadValue(info.FieldType, saveKeyName));</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 得到单个数据的方法</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;fieldType&quot;&gt;</span>字段类型，用于判断用哪个api来读取<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;saveKeyName&quot;&gt;</span>用于获取具体数据<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="built_in">object</span> <span class="title">LoadValue</span>(<span class="params">Type fieldType, <span class="built_in">string</span> saveKeyName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">int</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> PlayerPrefs.GetInt(saveKeyName, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">float</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> PlayerPrefs.GetFloat(saveKeyName, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">string</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> PlayerPrefs.GetString(saveKeyName, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">bool</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> PlayerPrefs.GetInt(saveKeyName, <span class="number">0</span>) == <span class="number">1</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(IList).IsAssignableFrom(fieldType))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//得到长度</span></span><br><span class="line">            <span class="built_in">int</span> count = PlayerPrefs.GetInt(saveKeyName, <span class="number">0</span>);</span><br><span class="line">            <span class="comment">//创建一个list用于存储数据</span></span><br><span class="line">            IList list = Activator.CreateInstance(fieldType) <span class="keyword">as</span> IList;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; count; i++) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//递归</span></span><br><span class="line">                list.Add(LoadValue(fieldType.GetGenericArguments()[<span class="number">0</span>], saveKeyName + i));</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(IDictionary).IsAssignableFrom(fieldType))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//得到长度</span></span><br><span class="line">            <span class="built_in">int</span> count = PlayerPrefs.GetInt(saveKeyName, <span class="number">0</span>);</span><br><span class="line">            <span class="comment">//创建一个dictionary用于存储数据</span></span><br><span class="line">            IDictionary dictionary = Activator.CreateInstance(fieldType) <span class="keyword">as</span> IDictionary;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; count; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//递归</span></span><br><span class="line">                dictionary.Add(LoadValue(fieldType.GetGenericArguments()[<span class="number">0</span>], saveKeyName + <span class="string">&quot;_key_&quot;</span> + i),</span><br><span class="line">                    LoadValue(fieldType.GetGenericArguments()[<span class="number">1</span>], saveKeyName + <span class="string">&quot;_value_&quot;</span> + i));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> dictionary;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//自定义类类型</span></span><br><span class="line">            <span class="keyword">return</span> LoadData(fieldType, saveKeyName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> height;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; dic1;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//以下都属于自定义类型存储</span></span><br><span class="line">    <span class="keyword">public</span> ItemInfo itemInfo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;ItemInfo&gt; itemList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, ItemInfo&gt; dic2;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ItemInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> num;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ItemInfo</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ItemInfo</span>(<span class="params"><span class="built_in">int</span> id, <span class="built_in">int</span> num</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//读取数据</span></span><br><span class="line">        PlayerInfo p1 = PlayerPrefsDataManager.Instance.LoadData(<span class="keyword">typeof</span>(PlayerInfo),<span class="string">&quot;Player1&quot;</span>) <span class="keyword">as</span> PlayerInfo;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//游戏逻辑中回去修改这个玩家数据</span></span><br><span class="line">        p1.age = <span class="number">18</span>;</span><br><span class="line">        p1.name = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">        p1.height = <span class="number">185</span>;</span><br><span class="line">        p1.itemList.Add(<span class="keyword">new</span> ItemInfo(<span class="number">1</span>, <span class="number">123</span>));</span><br><span class="line">        p1.itemList.Add(<span class="keyword">new</span> ItemInfo(<span class="number">2</span>, <span class="number">456</span>));</span><br><span class="line">        p1.dic1.Add(<span class="number">3</span>, <span class="string">&quot;长剑&quot;</span>);</span><br><span class="line">        p1.dic2.Add(<span class="number">4</span>, <span class="keyword">new</span> ItemInfo(<span class="number">3</span>,<span class="number">789</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//需要把这个数据对象的信息 存储到硬盘</span></span><br><span class="line">        PlayerPrefsDataManager.Instance.SaveData(p1, <span class="string">&quot;player1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Json"><a href="#Json" class="headerlink" title="Json"></a>Json</h1><p>全称：JavaScript 对象简谱 (JavaScript Object Notation)<br>Json 是国际通用的一种轻量级的数据交换格式<br>主要在网络通讯中用于传输数据，或本地数据存储和读取<br>易于人阅读和编写，同时也易于机器解析和生成，并有效地提升网络传输效率<br><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019887.png" alt="Pasted image 20230611211123"><br>我们一般<strong>使用 Json 文件来记录和传输数据</strong></p>
<p>Json 文档就是使用 Json 格式配置填写的文档后缀一般为.json<br>我们在游戏中可以把游戏数据按照 Json 的格式标准存储在 Json 文档中，再将 Json 文档存储在硬盘上或者传输给远端，达到数据持久化或者数据传输的目的。</p>
<table>
<thead>
<tr>
<th align="left"><strong>Json 和 Xml 的异同（Json 更好用！）</strong></th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>共同点</strong></td>
<td align="left"><strong>不同点</strong></td>
</tr>
<tr>
<td align="left">都是纯文本</td>
<td align="left">Json配置更简单</td>
</tr>
<tr>
<td align="left">都有层级结构</td>
<td align="left">Json在某些情况下读写更快速</td>
</tr>
<tr>
<td align="left">都具有描述性</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>优点</strong></p>
<ol>
<li>和 XML 一致的优点<ol>
<li>Json 是国际通用规则</li>
<li>跨平台（游戏，软件，网页等等都能用，不同操作系统也能用)</li>
<li>文件结构清晰易懂，非常容易编辑和理解</li>
<li>可以用于网络通信交换数据</li>
</ol>
</li>
</ol>
<p><strong>缺点</strong></p>
<ol>
<li>重复工作量繁多<ol>
<li>自定义数据类，都需要自己去实现存储读取的功能</li>
<li>而且代码的相似度极高</li>
</ol>
</li>
<li>数据容易被修改，只要找到文件位置，就可以轻易的进行数据修改</li>
</ol>
<p><strong>主要用处：</strong><br>网络游戏：可以用于存储一些客户端的简单不重要数据，可以用于传输信息<br>单机游戏：用于存储游戏相关数据，用于配置游戏数据（结合 UI 第三部曲一起讲解)</p>
<h2 id="语法规则"><a href="#语法规则" class="headerlink" title="语法规则"></a>语法规则</h2><p>注释格式和 cs 一样，<code>//</code> 或者 <code>/* */</code><br><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019888.png" alt="Pasted image 20230611211909"><br>{<br>“vertexIndex”:123<br>“pressure”:165<br>}<br><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019889.png" alt="Pasted image 20230611212009"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;大卫&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ids&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;students&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;小红&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">16</span><span class="punctuation">,</span><span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;小明&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">,</span><span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;home&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="string">&quot;成都&quot;</span><span class="punctuation">,</span><span class="attr">&quot;street&quot;</span><span class="punctuation">:</span><span class="string">&quot;春熙路&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;son&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//字典类型，键会变成双引号以后转换时要注意!!!</span></span><br><span class="line">    <span class="attr">&quot;dic&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;1&quot;</span><span class="punctuation">:</span><span class="string">&quot;123&quot;</span><span class="punctuation">,</span><span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="string">&quot;234&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Json 格式是一种键值对结构<br><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019890.png" alt="Pasted image 20230611211722|450"></p>
<blockquote>
<p>[!NOTE] 注意事项</p>
<ol>
<li>如果数据表示对象，那么最外层有大括号</li>
<li>一定是键值对形式</li>
<li><strong>键一定是字符串格式</strong> </li>
<li>键值对用逗号分开 </li>
<li>数组用 <code>[ ]</code> 包裹 </li>
<li>对象用<code>&#123;&#125;</code>包裹</li>
</ol>
</blockquote>
<h3 id="Excel-转-Json"><a href="#Excel-转-Json" class="headerlink" title="Excel 转 Json"></a>Excel 转 Json</h3><ol>
<li>在 Excel 表中配置游戏数据——更方便策划人员配置</li>
<li>将 Excel 表中配置的数据转为 Json 配置——方便将数据读取到内存中</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019891.png" alt="Pasted image 20230611213325"><br>上图 XML 中的数据对应的 Excel 表如下：</p>
<table>
<thead>
<tr>
<th>hp</th>
<th>speed</th>
<th>volume</th>
<th>resName</th>
<th>scale</th>
</tr>
</thead>
<tbody><tr>
<td>4</td>
<td>6</td>
<td>5</td>
<td>Airplane&#x2F;Airplan1</td>
<td>15</td>
</tr>
<tr>
<td>3</td>
<td>7</td>
<td>4</td>
<td>Airplane&#x2F;Airplan2</td>
<td>15</td>
</tr>
<tr>
<td>2</td>
<td>8</td>
<td>3</td>
<td>Airplane&#x2F;Airplan3</td>
<td>15</td>
</tr>
<tr>
<td>10</td>
<td>3</td>
<td>10</td>
<td>Airplane&#x2F;Airplan4</td>
<td>6</td>
</tr>
<tr>
<td>6</td>
<td>5</td>
<td>7</td>
<td>Airplane&#x2F;Airplan5</td>
<td>10</td>
</tr>
</tbody></table>
<p>转换方法：</p>
<ol>
<li>在百度或者 Google 搜索 Excel 转 Json.</li>
<li>在线转换网站 <a target="_blank" rel="noopener" href="https://www.bejson.com/json/col2json/">https://www.bejson.com/json/col2json/</a></li>
<li>进行转换</li>
<li>保存 Json 格式的数据</li>
</ol>
<p><strong>转换结果如下：</strong><br><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019892.png" alt="Pasted image 20230611214123|450"></p>
<figure class="highlight json"><figcaption><span>title:Roleinfo.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan3&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan4&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan5&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<h2 id="JsonUtlity"><a href="#JsonUtlity" class="headerlink" title="JsonUtlity"></a>JsonUtlity</h2><p><code>JsonUtlity</code> 是 unity 自带的用于解析 Json 的公共类</p>
<blockquote>
<p>[!NOTE] 序列化与反序列化</p>
<ol>
<li>序列化是将对象转换为二进制流的过程。把内存中的数据（类的对象数据）存储到硬盘上。</li>
<li>反序列化是将二进制流转换为对象的过程。把硬盘上的数据读取到内存（类的对象数据）中</li>
<li>序列化主要解决对象的传输问题。</li>
</ol>
</blockquote>
<p><strong>功能：</strong></p>
<ol>
<li>将内存中对象序列化为 Json 格式的字符串 </li>
<li>将 Json 字符串反序列化为类对象</li>
</ol>
<h3 id="在文件中读写字符串"><a href="#在文件中读写字符串" class="headerlink" title="在文件中读写字符串"></a>在文件中读写字符串</h3><p>导入命名空间 <code>using System.IO;</code></p>
<p>文件夹路径相关： [[《Unity Primer》#1 文件夹路径获取]]</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.存储字符串到指定路径文件中</span></span><br><span class="line"><span class="comment">//参数一：是存储的路径（若路径中有文件夹名，必须保证文件夹存在）</span></span><br><span class="line"><span class="comment">//参数二：存储的字符串内容</span></span><br><span class="line">File.WriteAllText(Application.persistentDataPath + <span class="string">&quot;/test.json&quot;</span>, <span class="string">&quot;Hello World&quot;</span>); </span><br><span class="line">print(Application.persistentDataPath); <span class="comment">//打印路径方便定位文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.在指定路径文件中读取字符串</span></span><br><span class="line"><span class="built_in">string</span> str = File.ReadAllText(Application.persistentDataPath + <span class="string">&quot;/test.json&quot;</span>);</span><br><span class="line">print(str); </span><br><span class="line">        </span><br></pre></td></tr></table></figure>


<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><p><strong>序列化：把内存中的数据（类的对象数据）存储到硬盘（以 Json 文件等方式保存）上</strong><br><strong>方法</strong>：<code>JsonUtility.ToJson(对象)</code> 把对象转换成json字符串</p>
<p><strong>注意:</strong></p>
<ol>
<li>float 序列化时看起来会有一些误差</li>
<li>自定义类需要加上序列化特性<code>[System.Serializable]</code></li>
<li>想要序列化私有变量需要加上特性 <code>[SerializeField]</code></li>
<li><code>JsonUtility</code> 不支持字典</li>
<li><code>JsonUtlity</code> 存储 null 对象不会是 null ，而是默认值的数据</li>
</ol>
<figure class="highlight cs"><figcaption><span>title:序列化</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Student</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span>(<span class="params"><span class="built_in">int</span> age, <span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyData</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> height;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> weight;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>[] ids1;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; ids2;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; dic1;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">string</span>,<span class="built_in">string</span>&gt; dic2;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Student stu;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Student&gt; stus;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> id;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">string</span> address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//1. 创建类的对象</span></span><br><span class="line">        MyData data = <span class="keyword">new</span> MyData();</span><br><span class="line">        </span><br><span class="line">        data.name = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">        data.age = <span class="number">18</span>;</span><br><span class="line">        data.height = <span class="number">1.75f</span>;</span><br><span class="line">        data.weight = <span class="number">175.0</span>;</span><br><span class="line">        data.sex = <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">        data.ids1 = <span class="keyword">new</span> <span class="built_in">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">        data.ids2 = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;()&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">        data.dic1 = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt;()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123;<span class="number">1</span>,<span class="string">&quot;张三&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="number">2</span>,<span class="string">&quot;李四&quot;</span>&#125;,</span><br><span class="line">            &#123;<span class="number">3</span>,<span class="string">&quot;王五&quot;</span>&#125;,</span><br><span class="line">        &#125;;</span><br><span class="line">        data.dic2 = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123; <span class="string">&quot;1&quot;</span>, <span class="string">&quot;123&quot;</span> &#125;,</span><br><span class="line">            &#123; <span class="string">&quot;2&quot;</span>, <span class="string">&quot;456&quot;</span> &#125;,</span><br><span class="line">            &#123; <span class="string">&quot;3&quot;</span>, <span class="string">&quot;789&quot;</span> &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        data.stu = <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        data.stus = <span class="keyword">new</span> List&lt;Student&gt;()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="number">18</span>, <span class="string">&quot;张三&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="number">12</span>, <span class="string">&quot;张s&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="number">18</span>, <span class="string">&quot;张sd&quot;</span>),</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 序列化，存储字符串</span></span><br><span class="line">        <span class="built_in">string</span> jsonStr = JsonUtility.ToJson(data);</span><br><span class="line">        File.WriteAllText(Application.persistentDataPath+ <span class="string">&quot;/data.json&quot;</span>, jsonStr);</span><br><span class="line">        print(Application.persistentDataPath);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>得到的 Json 文件内容如下：</p>
<figure class="highlight json"><figcaption><span>title:data.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;张三&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span><span class="attr">&quot;height&quot;</span><span class="punctuation">:</span><span class="number">1.75</span><span class="punctuation">,</span><span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span><span class="number">175.0</span><span class="punctuation">,</span><span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;ids1&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;ids2&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;stu&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;stus&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;张三&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">12</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;张s&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;张sd&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><p><strong>反序列化：把硬盘上的数据（Json 文件数据）读取到内存（类的对象数据）中</strong></p>
<p>方法：<code>JsonUtility.FromJson(字符串)</code></p>
<p>以 data. json 为例，我们对它反序列化：</p>
<figure class="highlight json"><figcaption><span>title:data.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;张三&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span><span class="attr">&quot;height&quot;</span><span class="punctuation">:</span><span class="number">1.75</span><span class="punctuation">,</span><span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span><span class="number">175.0</span><span class="punctuation">,</span><span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;ids1&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;ids2&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;stu&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;stus&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;张三&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">12</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;张s&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;张sd&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight cs"><figcaption><span>title:反序列化</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//反序列化要求我们要写出符合Json文件内容的数据结构</span></span><br><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Student</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span>(<span class="params"><span class="built_in">int</span> age, <span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyData</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> height;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> weight;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>[] ids1;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; ids2;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; dic1;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">string</span>,<span class="built_in">string</span>&gt; dic2;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Student stu;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Student&gt; stus;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> id;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">string</span> address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//1. 读取文件中的Json字符串</span></span><br><span class="line">        <span class="built_in">string</span> jsonStr = File.ReadAllText(Application.persistentDataPath+ <span class="string">&quot;/data.json&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2. 反序列化,将Json字符串转换为类对象</span></span><br><span class="line">        <span class="comment">//MyData data = JsonUtility.FromJson(jsonString,typeof(MyData)) as MyData;</span></span><br><span class="line">        <span class="comment">//更推荐使用泛型方法！！！</span></span><br><span class="line">        MyData data = JsonUtility.FromJson&lt;MyData&gt;(jsonStr);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3. 获取data对象的信息</span></span><br><span class="line">        print(data.age); </span><br><span class="line">        print(data.name);</span><br><span class="line">        print(data.height);</span><br><span class="line">        <span class="comment">//...省略</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li><strong><code>JsonUtlity</code> 无法直接读取数据集合（用 <code>[]</code> 包含的数组）</strong></li>
<li>Json文本编码格式要时 UTF-8 不然无法加载</li>
</ol>
<p>前文我们得到了一个 json 文件内容如下，如果直接对其反序列化会报错，因为 Unity 反序列化不支持读取数组</p>
<figure class="highlight json"><figcaption><span>title:Roleinfo.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan3&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan4&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan5&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Roleinfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> hp;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> speed;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> volume;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> resName;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> scale;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">jsonStr = File.ReadAllText(Application.streamingAssetsPath + <span class="string">&quot;/Roleinfo.json&quot;</span>);</span><br><span class="line">print(jsonstr);</span><br><span class="line"></span><br><span class="line"><span class="comment">//企图用一个List数组储存,报错！</span></span><br><span class="line">List&lt;Roleinfo&gt; roleinfoList = JsonUtility.FronJson&lt;List&lt;Roleinfo&gt;&gt;(jsonStr);</span><br></pre></td></tr></table></figure>

<p><strong>正确的读取方法：</strong></p>
<ol>
<li><p>修改 Json 文件：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;List&quot;</span>:[</span><br><span class="line">    &#123;<span class="string">&quot;hp&quot;</span>:<span class="number">4</span>,<span class="string">&quot;speed &quot;</span>:<span class="number">6</span>,<span class="string">&quot;volume&quot;</span>:<span class="number">5</span>,<span class="string">&quot;resName&quot;</span>:<span class="string">&quot;Airplane/Airplan1&quot;</span>,<span class="string">&quot;scale&quot;</span>:<span class="number">15</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;hp&quot;</span>:<span class="number">3</span>,<span class="string">&quot;speed &quot;</span>:<span class="number">7</span>,<span class="string">&quot;volume&quot;</span>:<span class="number">4</span>,<span class="string">&quot;resName&quot;</span>:<span class="string">&quot;Airplane/Airplan2&quot;</span>,<span class="string">&quot;scale&quot;</span>:<span class="number">15</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;hp&quot;</span>:<span class="number">2</span>,<span class="string">&quot;speed &quot;</span>:<span class="number">8</span>,<span class="string">&quot;volume&quot;</span>:<span class="number">3</span>,<span class="string">&quot;resName&quot;</span>:<span class="string">&quot;Airplane/Airplan3&quot;</span>,<span class="string">&quot;scale&quot;</span>:<span class="number">15</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;hp&quot;</span>:<span class="number">10</span>,<span class="string">&quot;speed &quot;</span>:<span class="number">3</span>,<span class="string">&quot;volume&quot;</span>:<span class="number">10</span>,<span class="string">&quot;resName&quot;</span>:<span class="string">&quot;Airplane/Airplan4&quot;</span>,<span class="string">&quot;scale&quot;</span>:<span class="number">6</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;hp&quot;</span>:<span class="number">6</span>,<span class="string">&quot;speed &quot;</span>:<span class="number">5</span>,<span class="string">&quot;volume&quot;</span>:<span class="number">7</span>,<span class="string">&quot;resName&quot;</span>:<span class="string">&quot;Airplane/Airplan5&quot;</span>,<span class="string">&quot;scale&quot;</span>:<span class="number">10</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加类, 然后读取</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Roleinfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> hp;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> speed;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> volume;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> resName;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> scale;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RoleData</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;RoleInfo&gt; list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jsonStr = File.ReadAllText(Application.streamingAssetsPath + <span class="string">&quot;/Roleinfo.json&quot;</span>);</span><br><span class="line">print(jsonstr);</span><br><span class="line"></span><br><span class="line">RoleData data = JsonUtility.FronJson&lt;RoleData&gt;(jsonStr); <span class="comment">//反序列化成功</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="LitJson"><a href="#LitJson" class="headerlink" title="LitJson"></a>LitJson</h2><ul>
<li>LitJson 是一个第三方库，用于处理 Json 的序列化和反序列化 </li>
<li>LitJson 是 cs 编写的，体积小、速度快、易于使用</li>
<li>它可以很容易的嵌入到我们的代码中</li>
<li>只需要将 LitJson 代码拷贝到工程中即可</li>
</ul>
<h3 id="获取-LitJson"><a href="#获取-LitJson" class="headerlink" title="获取 LitJson"></a>获取 LitJson</h3><ol>
<li>前往 LitJson 官网<a target="_blank" rel="noopener" href="https://litjson.net/">LitJSON - Home</a></li>
<li>通过官网前往 GitHub 获取最新版本代码</li>
<li>将 src 文件夹下的 LitJson 文件夹拷贝到 unity 工程中，即可开始使用 LitJson</li>
<li>使用时引用 LitJson 命名空间 <code>using LitJson;</code></li>
</ol>
<h3 id="序列化-1"><a href="#序列化-1" class="headerlink" title="序列化"></a>序列化</h3><p>方法：<code>JsonMapper.ToJson(对象)</code></p>
<p>注意:</p>
<ol>
<li>相对 JsonUtlity <strong>不需要加特性</strong></li>
<li><strong>不能序列化私有变量</strong></li>
<li><strong>支持字典类型</strong>，建议<strong>字典的键值都是字符串</strong>，因为 Json 的特点，键会加上双引号</li>
<li>可以保存 null 类型</li>
</ol>
<figure class="highlight cs"><figcaption><span>title:序列化</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Student</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span>(<span class="params"><span class="built_in">int</span> age, <span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyData</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> height;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> weight;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>[] ids1;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; ids2;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">string</span>,<span class="built_in">string</span>&gt; dic;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Student stu;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Student&gt; stus;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">string</span> address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//1. 创建类的对象</span></span><br><span class="line">        MyData data = <span class="keyword">new</span> MyData();</span><br><span class="line">        </span><br><span class="line">        data.name = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">        data.age = <span class="number">18</span>;</span><br><span class="line">        data.height = <span class="number">1.75f</span>;</span><br><span class="line">        data.weight = <span class="number">175.0</span>;</span><br><span class="line">        data.sex = <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">        data.ids1 = <span class="keyword">new</span> <span class="built_in">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">        data.ids2 = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;()&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">        data.dic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;()</span><br><span class="line">        &#123;</span><br><span class="line">            &#123; <span class="string">&quot;1&quot;</span>, <span class="string">&quot;123&quot;</span> &#125;,</span><br><span class="line">            &#123; <span class="string">&quot;2&quot;</span>, <span class="string">&quot;456&quot;</span> &#125;,</span><br><span class="line">            &#123; <span class="string">&quot;3&quot;</span>, <span class="string">&quot;789&quot;</span> &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        data.stu = <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        data.stus = <span class="keyword">new</span> List&lt;Student&gt;()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="number">18</span>, <span class="string">&quot;张三&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="number">12</span>, <span class="string">&quot;张s&quot;</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="number">18</span>, <span class="string">&quot;张sd&quot;</span>),</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2. 序列化，存储字符串</span></span><br><span class="line">        <span class="built_in">string</span> jsonStr = JsonMapper.ToJson(data);</span><br><span class="line">        File.WriteAllText(Application.persistentDataPath+ <span class="string">&quot;/data.json&quot;</span>, jsonStr);</span><br><span class="line">        print(Application.persistentDataPath);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到的 Json 文件内容如下：</p>
<figure class="highlight json"><figcaption><span>title:data.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u5F20\u4E09&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span><span class="attr">&quot;height&quot;</span><span class="punctuation">:</span><span class="number">1.75</span><span class="punctuation">,</span><span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span><span class="number">175.0</span><span class="punctuation">,</span><span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;ids1&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;ids2&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;dic&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;1&quot;</span><span class="punctuation">:</span><span class="string">&quot;123&quot;</span><span class="punctuation">,</span><span class="attr">&quot;2&quot;</span><span class="punctuation">:</span><span class="string">&quot;456&quot;</span><span class="punctuation">,</span><span class="attr">&quot;3&quot;</span><span class="punctuation">:</span><span class="string">&quot;789&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;stu&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;stus&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u5F20\u4E09&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">12</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u5F20s&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u5F20sd&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="反序列化-1"><a href="#反序列化-1" class="headerlink" title="反序列化"></a>反序列化</h3><p><strong>方法：</strong> <code>JsonMapper.ToObject(字符串)</code></p>
<p><strong>注意：</strong></p>
<ol>
<li><strong>类结构需要无参构造函数</strong>，否则反序列化时报错</li>
<li>字典虽然支持，但是<strong>键</strong>在使用为数值时会有问题，<strong>需要使用字符串类型</strong></li>
</ol>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Student</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//因为这里自己写了构造函数覆盖掉了无参构造函数</span></span><br><span class="line">    <span class="comment">//所以要手动添加无参构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span>()</span></span><br><span class="line">    &#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span>(<span class="params"><span class="built_in">int</span> age, <span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyData</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> height;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> weight;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>[] ids1;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; ids2;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">string</span>,<span class="built_in">string</span>&gt; dic;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Student stu;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Student&gt; stus;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">string</span> address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//1. 读取文件中的Json字符串</span></span><br><span class="line">        <span class="built_in">string</span> jsonStr = File.ReadAllText(Application.persistentDataPath+ <span class="string">&quot;/data.json&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2. 反序列化，将Json字符串转换为类对象</span></span><br><span class="line">        MyData data = JsonMapper.ToObject&lt;MyData&gt;(jsonStr);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3. 获取data对象的信息</span></span><br><span class="line">        print(data.age);</span><br><span class="line">        print(data.name);</span><br><span class="line">        print(data.height);</span><br><span class="line">        <span class="comment">//省略...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注意事项-1"><a href="#注意事项-1" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>LitJson <strong>可以直接读取数据集合</strong>（用 <code>[]</code> 包含的数组）</li>
<li>文本编码格式需要是 UTF-8， 不然无法加载</li>
</ol>
<p>前文我们得到了一个 json 文件内容如下，对其进行反序列化</p>
<figure class="highlight json"><figcaption><span>title:Roleinfo.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan3&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan4&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;speed &quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/Airplan5&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RoleInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> hp;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> speed;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> volume;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> resName;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> scale;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">jsonStr = File.ReadAllText(Application.streamingAssetsPath + <span class="string">&quot;/RoleInfo.json&quot;</span>);</span><br><span class="line">print(jsonstr);</span><br><span class="line"></span><br><span class="line"><span class="comment">//反序列化</span></span><br><span class="line"><span class="comment">//方式一：</span></span><br><span class="line">RoInfo[] arr = JsonMapper.ToObject&lt;RoleInfo[]&gt;(jsonStr);</span><br><span class="line"><span class="comment">//方式二：</span></span><br><span class="line">List&lt;RoInfo&gt; list = JsonMapper.ToObject&lt;List&lt;RoInfo&gt;&gt;(jsonStr); </span><br></pre></td></tr></table></figure>

<h2 id="Json-数据管理类"><a href="#Json-数据管理类" class="headerlink" title="Json 数据管理类"></a>Json 数据管理类</h2><figure class="highlight cs"><figcaption><span>title:JsonDataManager.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">* Json数据管理类 主要用于进行 Json的序列化和反序列化  </span></span><br><span class="line"><span class="comment">* 需要引用 LitJson 库</span></span><br><span class="line"><span class="comment">* 创建StreamingAssets文件夹 </span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* 序列化：JsonDataManager.Instance.SaveData(data, &quot;fileName&quot;);  </span></span><br><span class="line"><span class="comment">* 反序列化：MyData data = JsonDataManager.Instance.LoadData&lt;MyData&gt;(&quot;fileName&quot;, JsonType.LitJson); </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> LitJson;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Json序列化方案</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> JsonType</span><br><span class="line">&#123;</span><br><span class="line">    JsonUtlity,</span><br><span class="line">    LitJson,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Json数据管理类 主要用于进行 Json的序列化和反序列化</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JsonDataManager</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//单例模式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> JsonDataManager instance = <span class="keyword">new</span> JsonDataManager();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> JsonDataManager Instance =&gt; instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">JsonDataManager</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//序列化，存储Json数据到硬盘</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SaveData</span>(<span class="params"><span class="built_in">object</span> data, <span class="built_in">string</span> fileName, JsonType type = JsonType.LitJson</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//1. 确定存储路径</span></span><br><span class="line">        <span class="built_in">string</span> path = Application.persistentDataPath + <span class="string">&quot;/&quot;</span> + fileName + <span class="string">&quot;.json&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2. 序列化 得到Json字符串</span></span><br><span class="line">        <span class="built_in">string</span> jsonStr = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">switch</span> (type)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> JsonType.JsonUtlity:</span><br><span class="line">                jsonStr = JsonUtility.ToJson(data);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> JsonType.LitJson:</span><br><span class="line">                jsonStr = JsonMapper.ToJson(data);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="literal">default</span>:    </span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3. 把Json字符串存储到硬盘指定路径的文件中</span></span><br><span class="line">        File.WriteAllText(path, jsonStr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">LoadData</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> fileName, JsonType type = JsonType.LitJson</span>) <span class="keyword">where</span> T : <span class="keyword">new</span>() <span class="comment">//限制泛型存在无参公共构造函数</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//1. 确定从哪个路径读取</span></span><br><span class="line">        <span class="comment">//首先先判断，流动资源文件夹中是否有我们想要的数据，如果有就从中获取</span></span><br><span class="line">        <span class="built_in">string</span> path = Application.streamingAssetsPath + <span class="string">&quot;/&quot;</span> + fileName + <span class="string">&quot;.json&quot;</span>;</span><br><span class="line">        <span class="comment">//如果没有，就从持久数据文件夹中获取</span></span><br><span class="line">        <span class="keyword">if</span> (!File.Exists(path))</span><br><span class="line">        &#123;</span><br><span class="line">            path = Application.persistentDataPath + <span class="string">&quot;/&quot;</span> + fileName + <span class="string">&quot;.json&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果持久数据文件夹中也没有,那就返回默认对象</span></span><br><span class="line">        <span class="keyword">if</span> (!File.Exists(path))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> T();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2. 读取文件中的Json字符串</span></span><br><span class="line">        <span class="built_in">string</span> jsonStr = File.ReadAllText(path);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3. 反序列化，将Json字符串转换为类对象</span></span><br><span class="line">        T data =  <span class="literal">default</span>(T);</span><br><span class="line">        <span class="keyword">switch</span> (type)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> JsonType.JsonUtlity:</span><br><span class="line">                data = JsonUtility.FromJson&lt;T&gt;(jsonStr);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> JsonType.LitJson:</span><br><span class="line">                data = JsonMapper.ToObject&lt;T&gt;(jsonStr);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//4. 返回对象，通过该对象即可获取对象信息</span></span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="序列化-2"><a href="#序列化-2" class="headerlink" title="序列化"></a>序列化</h3><figure class="highlight cs"><figcaption><span>title:序列化</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Student</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span>()</span></span><br><span class="line">    &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span>(<span class="params"><span class="built_in">int</span> age, <span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyData</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> height;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> weight;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>[] ids1;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; ids2;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; dic;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Student stu;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Student&gt; stus;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">string</span> address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NewBehaviourScript</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">         <span class="comment">//1. 创建类的对象</span></span><br><span class="line">         MyData data = <span class="keyword">new</span> MyData();</span><br><span class="line">        </span><br><span class="line">         data.name = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">         data.age = <span class="number">18</span>;</span><br><span class="line">         data.height = <span class="number">1.75f</span>;</span><br><span class="line">         data.weight = <span class="number">175.0</span>;</span><br><span class="line">         data.sex = <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">         data.ids1 = <span class="keyword">new</span> <span class="built_in">int</span>[] &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">         data.ids2 = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;() &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">         data.dic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;()</span><br><span class="line">         &#123;</span><br><span class="line">             &#123; <span class="string">&quot;1&quot;</span>, <span class="string">&quot;123&quot;</span> &#125;,</span><br><span class="line">             &#123; <span class="string">&quot;2&quot;</span>, <span class="string">&quot;456&quot;</span> &#125;,</span><br><span class="line">             &#123; <span class="string">&quot;3&quot;</span>, <span class="string">&quot;789&quot;</span> &#125;,</span><br><span class="line">         &#125;;</span><br><span class="line">        </span><br><span class="line">         data.stu = <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">         data.stus = <span class="keyword">new</span> List&lt;Student&gt;()</span><br><span class="line">         &#123;</span><br><span class="line">             <span class="keyword">new</span> Student(<span class="number">18</span>, <span class="string">&quot;张三&quot;</span>),</span><br><span class="line">             <span class="keyword">new</span> Student(<span class="number">12</span>, <span class="string">&quot;张s&quot;</span>),</span><br><span class="line">             <span class="keyword">new</span> Student(<span class="number">18</span>, <span class="string">&quot;张sd&quot;</span>),</span><br><span class="line">         &#125;;</span><br><span class="line">        </span><br><span class="line">         <span class="comment">//2. 序列化，存储字符串</span></span><br><span class="line">         JsonDataManager.Instance.SaveData(data, <span class="string">&quot;myfile&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="反序列化-2"><a href="#反序列化-2" class="headerlink" title="反序列化"></a>反序列化</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Student</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span>()</span></span><br><span class="line">    &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span>(<span class="params"><span class="built_in">int</span> age, <span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyData</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> height;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> weight;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>[] ids1;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; ids2;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; dic;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Student stu;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Student&gt; stus;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">string</span> address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NewBehaviourScript</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">         <span class="comment">//1. 反序列化，将Json字符串转换为类对象</span></span><br><span class="line">         MyData data = JsonDataManager.Instance.LoadData&lt; MyData&gt;(<span class="string">&quot;myfile&quot;</span>, JsonType.LitJson);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2. 获取data对象的信息</span></span><br><span class="line">        print(data.name);</span><br><span class="line">        print(data.age);</span><br><span class="line">        print(data.height);</span><br><span class="line">        <span class="comment">//省略...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019893.png" alt="Pasted image 20230612002808"><br>Excel 转换过程特别麻烦，最好写一个自动化工具，自动将 Excel 转换成 Json，并自动生成对应的数据结构。（之后的编辑器课程讲）<br><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019894.png" alt="Pasted image 20230612002828"></p>
<h1 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h1><h3 id="程序在表格文件中读取数据。"><a href="#程序在表格文件中读取数据。" class="headerlink" title="程序在表格文件中读取数据。"></a>程序在表格文件中读取数据。</h3><ul>
<li>首选创建 excel，并保存为 csv 格式。用文本打开，可以看到一行行的字符串，以逗号分隔。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019884.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019885.png"></p>
<ul>
<li>为 csv 文件编写一个脚本，用于对此文件进行操作，打开读取 csv 文件，将 csv 中数据存储到一个 list 中，对 list 的数据读取的操作，脚本为 csvController ：</li>
</ul>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">csvController</span>  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> csvController csv;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">string</span>[]&gt; arrayData;  </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">csvController</span>()   <span class="comment">//单例，构造方法为私有</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        arrayData = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>[]&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> csvController <span class="title">GetInstance</span>()   <span class="comment">//单例方法获取对象</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(csv == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            csv = <span class="keyword">new</span> csvController();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> csv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadFile</span>(<span class="params"><span class="built_in">string</span> path,<span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        arrayData.Clear();</span><br><span class="line">        StreamReader sr = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> file_url = path + <span class="string">&quot;//&quot;</span> + fileName;    <span class="comment">//根据路径打开文件</span></span><br><span class="line">            sr = File.OpenText(file_url);</span><br><span class="line">            Debug.Log(<span class="string">&quot;File Find in &quot;</span> + file_url);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span></span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">&quot;File cannot find ! &quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>; </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> line;</span><br><span class="line">        <span class="keyword">while</span>((line = sr.ReadLine()) != <span class="literal">null</span>)   <span class="comment">//按行读取</span></span><br><span class="line">        &#123;</span><br><span class="line">            arrayData.Add(line.Split(<span class="string">&#x27;,&#x27;</span>));   <span class="comment">//每行逗号分隔,split()方法返回 string[]</span></span><br><span class="line">        &#125;</span><br><span class="line">        sr.Close();</span><br><span class="line">        sr.Dispose();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">getString</span>(<span class="params"><span class="built_in">int</span> row,<span class="built_in">int</span> col</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> arrayData[row][col];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">getInt</span>(<span class="params"><span class="built_in">int</span> row,<span class="built_in">int</span> col</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>.Parse(arrayData[row][col]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在其他脚本中调用</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">Start</span> <span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//csvController加载csv文件，单例模式，这个类只有一个对象，这个对象只能加载一个csv文件</span></span><br><span class="line">        csvController.GetInstance().loadFile(Application.dataPath + <span class="string">&quot;/Res&quot;</span>, <span class="string">&quot;csvTest.csv&quot;</span>);</span><br><span class="line">        <span class="comment">//根据索引读取csvController中的list（csv文件的内容）数据</span></span><br><span class="line">        speed = csvController.GetInstance().getInt(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        Debug.Log(<span class="string">&quot;Player speed is &quot;</span> + csvController.GetInstance().getInt(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ffda934b5e15#">http://www.jianshu.com/p/ffda934b5e15#</a></p>
<p>程序读取文件信息，这个感觉和以前 C++ 读取 text&#x2F;dat 文件差不多的。<br>unity 存储数据是如何实现的？参考 <a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=http://www.wtoutiao.com/a/2139080.html">http://www.wtoutiao.com/a/2139080.html</a></p>
<h1 id="ScriptableObject"><a href="#ScriptableObject" class="headerlink" title="ScriptableObject"></a>ScriptableObject</h1><p>在<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91&spm=1001.2101.3001.7020">游戏开发</a>过程中，我们会经常与数据打交道。很多时候，我们会为游戏对象配置数据，比如玩家初始生命值、技能伤害等。那么就需要有个能够存储数据的东西来和游戏对象进行交互。</p>
<p>假设现在要做一个 “打飞机” 的游戏，玩家操控的飞机在吃了不同道具后会发射不同类型的子弹，这些子弹的飞行速度和伤害各不相同。那么显然我要为每一种子弹配置好它的属性值。</p>
<p>实现方式有很多，比如我为每种子弹创建预制体，然后写脚本去定义代表子弹各个属性的成员变量，再把脚本挂载到子弹预制体上。为了方便在开发时调试我们可以将这些变量声明为 public ，以便我们在编辑器面板中对数据进行改动。  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019895.png" alt="4e1d663836a8844b9b98207bded7f381_MD5"></p>
<p>这么做其实是有缺点的：</p>
<p>1） <strong>每生成一个子弹就会对原来的预制体进行拷贝，其挂载的 Bullet 数据脚本同样会被拷贝，因此同样的数据会被拷贝多次</strong>。而我们规定同一种子弹的数据是相同的，也就是同一种子弹，不管生成了多少个，它们都共用一套数据。因此，这种方法会<strong>创建多余的数据脚本，造成内存浪费</strong>。<br>2） 如果预制体上的脚本丢失，之前在 Inspector 面板中配置的数据也会消失。<br>😫😫😫😫😫😫😫</p>
<p>不过解决方法有很多，比如：</p>
<p>1️⃣ 我们可以创建一个全局的数据管理中心脚本，通过静态变量去调用每种子弹的数据。不过这种数据配置方式不能实现数据的持久化，而且必须要打开代码文件进行修改，面对茫茫代码可能不是那么直观。<br>2️⃣ 我们还可以用上像 <strong>excel，Json，xml 等持久化数据存储</strong>的方法，结合 Unity 对准备好的数据文件进行数据读写。这么做的好处是可以实现数据的持久化，比如在游戏过程中修改了数据，退出游戏后下一次打开游戏使用的就是之前修改过的数据。</p>
<p>那么现在，我将介绍另一种用于<strong>数据存储的解决方案——ScriptableObject</strong>。它也能弥补通过挂载继承自 MonoBehaviour 的脚本来配置数据的一些不足。相较于 excel，Json，xml 这类持久化数据存储的方法，它有些额外的优点，但是也存在一些局限性。我将会在接下来的部分详细说明。</p>
<h2 id="🔍-什么是-ScriptableObject"><a href="#🔍-什么是-ScriptableObject" class="headerlink" title="🔍 什么是 ScriptableObject"></a>🔍 什么是 ScriptableObject</h2><ul>
<li>ScriptableObject 是 Unity 提供的一个<strong>数据配置存储基类</strong>，它是一个可以用来保存大量数据的<strong>数据容器</strong>，我们可以将它保存为自定义的<strong>数据资源文件</strong>。</li>
<li>ScriptableObject 是一个类似 MonoBehaviour 的基类，继承自 UnityEngine. Object 。要想使用它，需要我们写个脚本去继承 ScriptableObject 。需要注意的是，继承自 SctiptableObject 的脚本无法挂载到游戏物体上，毕竟它不是继承自 MonoBehaviour。</li>
<li>ScriptableObject 类的<strong>实例</strong>会被保存成资源文件（. asset 文件），和预制体，材质球，音频文件等类似，都是一种资源文件，存放在 Assets 文件夹下，创建出来的实例也是唯一存在的。</li>
</ul>
<p>简单的看一下 ScriptableObject 的实例长啥样：  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019897.png" alt="1e5f113aea457891c1416f9a301fb188_MD5"></p>
<p>上图是编辑器窗口中的样子，再来看看本地文件夹中的模样：  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019898.png" alt="693da9ec55e4e252b4d18f0a25991a8b_MD5"></p>
<p>可以看到 ScriptableObject 实例就是一种资源文件。细心的你可能会发现我这里强调的是 <strong>ScriptableObject 的实例（instance）</strong>，那么你也许会联想到类与实例（或者叫对象）的关系。其实 ScriptableObject 也是如此，<strong>它本身是个类，实例化之后得到的就是数据资源文件</strong>。</p>
<p>那么，要如何使用 ScriptableObject 这个类，又如何创建出编辑器面板中的这个数据资源文件呢？在此之前，我先介绍一下 ScriptableObject 的主要作用，来加深大家对它的理解。刚刚已经介绍了它是什么东西，那么现在将进一步介绍它一般能用来做什么。</p>
<h2 id="🔍-ScriptableObject-的主要作用"><a href="#🔍-ScriptableObject-的主要作用" class="headerlink" title="🔍 ScriptableObject 的主要作用"></a>🔍 ScriptableObject 的主要作用</h2><p>大体上可以分成三点：<br>1） 编辑模式下的数据持久化<br>2） 配置文件 （配置游戏中的数据）<br>3） 数据复用 （多个对象共用一套数据）</p>
<h3 id="💪-编辑模式下的数据持久化"><a href="#💪-编辑模式下的数据持久化" class="headerlink" title="💪 编辑模式下的数据持久化"></a>💪 编辑模式下的数据持久化</h3><p>数据持久化：使用数据时从硬盘中读取，数据改变后保存到硬盘上，游戏退出后数据信息被存储到硬盘上，达到持久化的目的。</p>
<p>当我们在编辑模式下修改了继承自 ScriptableObject 对象的数据文件内容时，修改的数据将被保存到磁盘上。但是在发布运行后，即使在游戏中修改了 ScriptableObject 的数据，改后的数据并不会保存在本地，<strong>重新打开运行时数据并还是配置的初始数据</strong>。</p>
<p><strong>因此 ScriptableObject 适合在编辑模式下调试数据，但不适合存储在游戏打包发布后的运行期间会改变的数据</strong> ❗</p>
<h3 id="💪-配置文件"><a href="#💪-配置文件" class="headerlink" title="💪 配置文件"></a>💪 配置文件</h3><p>ScriptableObject 非常适合用来做配置文件。因为：<br>1）配置文件的数据在游戏发布之前就定好了规则<br>2）配置文件的数据在游戏运行时只会读出来使用，不会修改数据的内容<br>3）传统的配置文件一般会通过 xml、json、excel 等方式来配置游戏数据<br>，相对来说都是在 Unity 外部通过其它格式的文件对数据进行配置。<br>而通过 ScriptableObject 我们可以直接<strong>在 Unity 内部的 Inspector 面板中进行数据的配置</strong>，有时候会更加方便。</p>
<p>我们也可以利用 ScriptableObject 数据文件来制作编辑器相关功能，比如制作 Unity 内置的技能编辑器、关卡编辑器等。因为内置编辑器只在编辑模式下运行，在编辑模式下 ScriptableObject 正好具有数据持久化的特性。</p>
<h3 id="💪-数据复用"><a href="#💪-数据复用" class="headerlink" title="💪 数据复用"></a>💪 数据复用</h3><p>对于只用不变的数据，通过使用 ScriptableObject 可以有效避免内存的浪费，因为它将共用的数据单独抽离出来，供相同的一类对象使用。</p>
<p>还是利用前言中举的例子，比如一个子弹对象，通过面向对象的思想，会写一个继承自 MonoBehaviour 的脚本，声明相关的属性，然后挂载到子弹预设体上，把子弹需要的数据赋给子弹对象。如果我们要求子弹的数据是<strong>不会改变</strong>的，那么这样每次实例化一个子弹，对内存来说会造成一定的浪费，因为每次生成一个子弹都会复制 Assets 下子弹预制体的值，也就是多次复制了相同的数据。  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019899.png" alt="65d2a4a611ac044c5abbacc9b610ec39_MD5"></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019900.png" alt="4f6b0bcd41992e531c687a571c9fdd21_MD5"></p>
<p><strong>这样每一个子弹预设体上都有该脚本，该脚本中的所有的属性都会分配一次内存</strong>。</p>
<p>但是如果是用 ScriptableObject，对于某一种子弹，我们<strong>只需要拥有一份 ScriptableObject 的实例，也叫做数据资源文件，然后这一种子弹的所有游戏物体都引用这个数据资源文件</strong>，就可实现不管生成多少个子弹，只要它们属于同一类，都会共用一份数据。  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019901.png" alt="553cf2048f555db8969ad84bbfa5c3e5_MD5"></p>
<p>这里每个子弹预制体中的子弹脚本都只是持有 Bullet Data 这一个 ScriptableObject 实例的引用，真正在内存当中分配空间的只有红线所指向的 ScriptableObject 实例，也就是我们的数据资源文件。</p>
<h2 id="🔍-如何创建-ScriptableObject"><a href="#🔍-如何创建-ScriptableObject" class="headerlink" title="🔍 如何创建 ScriptableObject"></a>🔍 如何创建 ScriptableObject</h2><p>ScriptableObject 是个类，因此自然会有先声明，后实例化的步骤。</p>
<h3 id="📕-步骤一：声明自定义的数据容器"><a href="#📕-步骤一：声明自定义的数据容器" class="headerlink" title="📕 步骤一：声明自定义的数据容器"></a>📕 步骤一：声明自定义的数据容器</h3><p>第一步：创建一个脚本继承自 ScriptableObject 类<br>第二步：在该类中声明成员，规定要存哪些类型的数据 （如果后续创建了数据资源文件，要在 Inspector 窗口中看到这些成员，需要把它们声明为 public ）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class BulletData : ScriptableObject</span><br><span class="line">&#123;</span><br><span class="line">    public float speed;</span><br><span class="line">    public float damage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这一步就相当于定义了一个数据的模板。</p>
<h3 id="📕-步骤二：根据自定义的-ScriptableObject-数据容器创建数据文件"><a href="#📕-步骤二：根据自定义的-ScriptableObject-数据容器创建数据文件" class="headerlink" title="📕 步骤二：根据自定义的 ScriptableObject 数据容器创建数据文件"></a>📕 步骤二：根据自定义的 ScriptableObject 数据容器创建数据文件</h3><p>这一步就相当于根据定义的模板实例化 ScriptableObject ，具体有两种方法：</p>
<h4 id="😊-方法一：为类添加-CreateAssetMenu-特性，在编辑器的菜单中创建资源文件"><a href="#😊-方法一：为类添加-CreateAssetMenu-特性，在编辑器的菜单中创建资源文件" class="headerlink" title="😊 方法一：为类添加 CreateAssetMenu 特性，在编辑器的菜单中创建资源文件"></a>😊 方法一：为类添加 CreateAssetMenu 特性，在编辑器的菜单中创建资源文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[CreateAssetMenu (fileName = &quot;BulletData&quot;, menuName = &quot;ScriptableObject/子弹数据&quot;, order = 0)]</span><br><span class="line">public class BulletData : ScriptableObject</span><br><span class="line">&#123;</span><br><span class="line">    public float speed;</span><br><span class="line">    public float damage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种创建 ScriptableObject 资源文件的方法还是比较简单且常见的，主要就是在类的上方加一个 CreateAssetMenu 特性。</p>
<p>fileName 表示数据资源文件创建出来的文件名。<br>menuName 表示在 Assets&#x2F;Create 下的名字。<br>order 表示在 Assets&#x2F;Create 下的位置顺序。</p>
<p>这里涉及到一点编辑器扩展的知识。光看这一段文字描述也许看不出个所以然，那么接下来我会带着大家实操一遍，过程其实非常的简单粗暴😉。<br>既然要创建资源文件，大家其实可以类比创建材质、预制体，它们也是一种资源文件。要想创建它们，我们只要在编辑器中的 Asset 目录或者它的子目录中按下鼠标右键（或者直接点击编辑器最上方菜单栏的 Assets），然后点击 Create，找到我们想要创建的资源就行了。  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019902.png" alt="6a54d05cff033c5abbd0c5e5f1968a7c_MD5"></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019903.png" alt="cce25a63f89be9ccaecf1528e07dcaeb_MD5"></p>
<p>（注：点击 Project 面板中的 “+” 也能实现）</p>
<p>那么 ScriptableObject 也是一样，只不过<strong>我们要手动为继承自 ScriptableObject 的类添加 CreateAssetMenu 特性，让它能像预制体、材质球这类资源文件一样能够在编辑器面板中手动创建。</strong></p>
<p>如果你像我演示的代码那样添加了 CreateAssetMenu 特性，你会发现 Create 的下一级目录的最上方出现了一个 ScritableObject。  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019904.png" alt="f331e30c66459ff2c433feadbea5a632_MD5"></p>
<p>我们还可以把鼠标移到菜单中 ScriptableObject 的位置，可以发现它又展开了下一级目录：  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019905.png" alt="d82ba5e8713ff5a2433f2b8e28b60252_MD5"></p>
<p>这时候出现了我们的 “子弹数据” （这一级目录下还有我之前创建的其他 ScriptableObject） ，ScriptableObject 下的“子弹数据” 就是我们刚刚在 menuName 中定义的，然后我们点击它。  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019897.png" alt="1e5f113aea457891c1416f9a301fb188_MD5"></p>
<p>这时候就成功创建了我们的数据资源文件。然后我们就可以在 Inspector 面板中配置数据了。<br>回看 CreateAssetMenu 特性, 你是否能理解它的一些属性了呢？</p>
<p>fileName 的值就对应了我们创建出来的数据资源文件的文件名。<br>menuName 的值对应了我们要如何在编辑器面板中创建出数据资源文件的路径，从 Assets&#x2F;Create 开始，我们如果想将路径分级，可以在路径名之间用 “&#x2F;” 隔开。<br>那 order 是怎么一回事呢？它的默认值是 0，我们之前看到 ScriptableObject 目录下 “子弹数据” 是排在第一位的，那我如果把 order 的值由 0 改成 1 会发生什么事呢？请看：  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019907.png" alt="4ca118182146752514fc333a59e78251_MD5"></p>
<p>事先说明一下，我的另外两个 ScriptableObject 的 order 也是设成 0，那么你可以看到 “子弹数据” 现在排在了第三位。<br>那么这个 order 其实就规定了创建 ScriptableObject 数据资源文件的路径在菜单上显示的位置，order 越低，就显示在越上面。如果 order 相同，则是按照继承自 ScriptableObject 的脚本创建时间排序，新创建的排在上面。</p>
<h4 id="😊-方法二：利用-ScriptableObject-的静态方法创建数据对象，然后将数据对象保存在工程目录下"><a href="#😊-方法二：利用-ScriptableObject-的静态方法创建数据对象，然后将数据对象保存在工程目录下" class="headerlink" title="😊 方法二：利用 ScriptableObject 的静态方法创建数据对象，然后将数据对象保存在工程目录下"></a>😊 方法二：利用 ScriptableObject 的静态方法创建数据对象，然后将数据对象保存在工程目录下</h4><p>可以新建一个脚本（可以不用继承自 MonoBehavoiur，这个脚本不用挂载到游戏物体上），引入 UnityEditor 命名空间：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line">using UnityEditor;</span><br><span class="line">public class ScriptableObjectTool </span><br><span class="line">&#123;</span><br><span class="line">    [MenuItem (&quot;ScritableObject/CreateMyData&quot;)]</span><br><span class="line">    public static void CreateMyData()</span><br><span class="line">    &#123;</span><br><span class="line">        //创建数据资源文件</span><br><span class="line">        //泛型是继承自ScriptableObject的类</span><br><span class="line">        BulletData asset = ScriptableObject.CreateInstance&lt;BulletData&gt;();</span><br><span class="line">        //前一步创建的资源只是存在内存中，现在要把它保存到本地</span><br><span class="line">        //通过编辑器API，创建一个数据资源文件，第二个参数为资源文件在Assets目录下的路径</span><br><span class="line">        AssetDatabase.CreateAsset(asset, &quot;Assets/Resources/ScriptableObject/BulletData.asset&quot;);</span><br><span class="line">        //保存创建的资源</span><br><span class="line">        AssetDatabase.SaveAssets();</span><br><span class="line">        //刷新界面</span><br><span class="line">        AssetDatabase.Refresh();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>保存脚本后，会发现编辑器最上方的菜单栏多出了这个（MenuItem 特性起的作用）：  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019908.png" alt="372912b963bcc47098df28a5274fa252_MD5"></p>
<p>点击后，可以看到 Assets&#x2F;Resources&#x2F;ScriptableObject 文件夹下多了我们想要的数据资源文件：  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019909.png" alt="9169cae06e4925acec6959d3a8bf1e3f_MD5"></p>
<p><strong>注意：</strong><br>1️⃣ 使用这种方法无需在继承自 ScriptableObject 的类上增加 CreateAssetMenu 特性。<br>2️⃣ <strong>刚刚创建的 ScriptableObjectTool 脚本需要放在 Assets 文件夹下任一位置的 Editor 文件夹下</strong>（这个文件夹放哪都行，看自己需求，只要在 Assets 文件夹或其子文件夹下就好）。<strong>因为我们引入了 UnityEditor 命名空间，这意味着这个脚本只在编辑模式下会用到，实际打包发布后是不会用到的</strong>。如果没放在 Editor 文件夹下，Unity 打包时会认为此脚本是会被一起打包，作用于游戏运行期间，与 Editor 命名空间的性质相矛盾，所以会报错。（这里就涉及到一些扩展编辑器的知识）  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019910.png" alt="8b32c27a0db09a13b6f0ffe140ed0698_MD5"></p>
<h3 id="😊-总结创建-ScriptableObject-的步骤"><a href="#😊-总结创建-ScriptableObject-的步骤" class="headerlink" title="😊 总结创建 ScriptableObject 的步骤"></a>😊 总结创建 ScriptableObject 的步骤</h3><p>1）写个脚本，继承 ScriptableObject 类<br>2）声明需要的数据变量<br>3）添加特性来创建数据资源文件。这相当于一种专门用来记录数据的资源，和预制体，材质球，音频文件一样都是资源，只不过是通过继承自 ScriptableObject 类生成的数据资源文件。</p>
<h2 id="🔍-如何使用-ScriptableObject"><a href="#🔍-如何使用-ScriptableObject" class="headerlink" title="🔍 如何使用 ScriptableObject"></a>🔍 如何使用 ScriptableObject</h2><p>我们刚刚介绍了如何创建 ScriptableObject，但是此时我们只是创建了一个数据资源，并没有将它存储的数据和我们的游戏对象关联起来。那么接下来，我将介绍如何去运用创建出来的数据资源文件。</p>
<h3 id="📕-Ⅰ-数据文件的使用"><a href="#📕-Ⅰ-数据文件的使用" class="headerlink" title="📕 Ⅰ. 数据文件的使用"></a>📕 Ⅰ. 数据文件的使用</h3><h4 id="😊方法一：通过-Inspector-面板中的-public-变量进行关联"><a href="#😊方法一：通过-Inspector-面板中的-public-变量进行关联" class="headerlink" title="😊方法一：通过 Inspector 面板中的 public 变量进行关联"></a>😊方法一：通过 Inspector 面板中的 public 变量进行关联</h4><p>步骤一：创建一个数据文件<br>步骤二：在继承自 MonoBehaviour 类中声明数据容器类型的成员，在 Inspector 面板中进行关联（拖拽的是数据文件而不是继承自 ScriptableObject 类的脚本）  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019911.png" alt="564200183c038bc2577039137227c635_MD5"></p>
<p>不使用 ScriptableObject 的时候，我们的子弹脚本是这么写的：  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019912.png" alt="733ebd2f19481b7dc3415d4562c806a5_MD5"></p>
<p>那么现在我们只需把数据有关的部分替换成 ScriptableObject 的引用就行了：  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019913.png" alt="c9dbc2093c66bf771b0190672238f238_MD5"></p>
<p>然后在 Inspector 面板中拖拽赋值：  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019914.png" alt="b09f13f16b2b6fc509d2f5a3be836038_MD5"></p>
<p>这个时候游戏对象就和数据资源关联起来了，不管有多少个物体挂载了 Bullet 脚本，它们关联的都是同一份数据资源。</p>
<h4 id="😊方法二：直接加载数据资源文件"><a href="#😊方法二：直接加载数据资源文件" class="headerlink" title="😊方法二：直接加载数据资源文件"></a>😊方法二：直接加载数据资源文件</h4><p>可以用 Resources，AddressBundle，Addressables 等方式加载数据资源文件。</p>
<h3 id="📕-Ⅱ-生命周期函数"><a href="#📕-Ⅱ-生命周期函数" class="headerlink" title="📕 Ⅱ. 生命周期函数"></a>📕 Ⅱ. 生命周期函数</h3><p>ScriptableObject 和 MonoBehaviour 类似，也存在生命周期函数，但是数量会少很多。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Awake 数据文件创建时调用</span><br><span class="line">OnDestroy 对象将被销毁时调用</span><br><span class="line">OnEnable 创建或加载对象时调用</span><br><span class="line">OnDisable 对象销毁时，即将加载脚本程序集时调用</span><br><span class="line">OnValidate 编辑器才会调用的函数，Unity 在加载脚本或者 Inspector 面板中更改值时调用</span><br></pre></td></tr></table></figure>

<p>除此之外继承自 ScriptableObject 的类中也可以自定义函数，并不是只能声明和数据有关的变量。</p>
<h3 id="📕-Ⅲ-实现非持久化数据"><a href="#📕-Ⅲ-实现非持久化数据" class="headerlink" title="📕 Ⅲ. 实现非持久化数据"></a>📕 Ⅲ. 实现非持久化数据</h3><p>我们知道 ScriptableObject 在打包发布后是不具备数据持久化的功能的，但是它能实现编辑模式下的持久化数据。只要我们在编辑器面板中手动创建一个数据资源文件，这个时候相当于我们在磁盘中真正创建了一个文件，之后在编辑模式中 ScriptableObject 的数据改动会被保存在磁盘中。</p>
<p>其实，对于某些数据资源，我们不一定要将数据保存为磁盘中的资源文件占据空间，而只希望运行期间在内存中临时生成一组共用的数据给对象使用就够了，退出游戏后就释放掉生成的数据资源。<strong>这个时候不论是在编辑模式还是打包发布后，数据都是非持久化的，也就是改动的数据不会被保存到磁盘中而是内存中</strong>。退出游戏后重新打开，读取的还是初始配置的数据。</p>
<p><strong>如何生成非持久化数据？</strong><br>利用 ScriptableObject 类中的静态方法 CreateInstance&lt;&gt;() 。该方法可以在运行时创建出指定继承自 ScriptableObject 的对象，该对象只存在于内存中，可以被 GC 垃圾回收，调用一次就创建一次。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public BulletData bulletData;</span><br><span class="line">void Start ()&#123;</span><br><span class="line">//通过这种方式创建的数据对象，它里面的默认值不会受到脚本中设置的影响 </span><br><span class="line">    bulletData=ScriptableObject.CreateInstance&lt;BulletData&gt;();   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们把刚刚创建的数据资源文件在文件夹中删掉，做个小测试，在脚本中用上 CreateInstance&lt;&gt;() 方法：  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019915.png" alt="de5e3d91f9b2b2c8ce783f010fa29e16_MD5"></p>
<p>在编辑模式中，游戏还未运行时 bulletData 引用的是空数据。<br>然后运行游戏，可以发现 bulletData 已经关联上了一个子弹数据资源：  </p>
<p><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190019916.png" alt="edf8e6b1e0a54551985d38c40c071bd1_MD5"></p>
<p>这个数据资源文件是被动态创建出来的，只被创建在内存中。当我们关闭游戏后 bulletData 引用的资源重新变成空数据。</p>
<h3 id="📕-Ⅳ-让-ScriptableObject-真正意义上持久化"><a href="#📕-Ⅳ-让-ScriptableObject-真正意义上持久化" class="headerlink" title="📕 Ⅳ. 让 ScriptableObject 真正意义上持久化"></a>📕 Ⅳ. 让 ScriptableObject 真正意义上持久化</h3><p>既然 ScriptableObject 本身无法在游戏打包发布后实现数据持久化，那么我们可以配合 Json，PlayerPrefs， xml ，二进制等方式来实现 ScriptableObject 真正意义上的数据持久化。</p>
<p>以 Json 为例：<br><strong>利用 Json 结合 ScriptableObject 存储数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class TestScriptableObject : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">    public BulletData bulletData;</span><br><span class="line">    void Start() &#123;</span><br><span class="line">        bulletData= ScriptableObject.CreateInstance&lt;BulletData&gt;();</span><br><span class="line">        bulletData.speed = 9.5f;</span><br><span class="line">        bulletData.damage = 100.0f;</span><br><span class="line">        //将数据对象序列化为Json字符串</span><br><span class="line">        string str = JsonUtility.ToJson(bulletData);</span><br><span class="line">        //将数据序列化后的结果存入指定路径当中</span><br><span class="line">        File.WriteAllText(Application.persistentDataPath + &quot;/testJson.json&quot;, str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>利用 Json 结合 ScriptableObject 读取数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//从本地读取Json字符串</span><br><span class="line">        string text = File.ReadAllText(Application.persistentDataPath + &quot;/testJson.json&quot;);</span><br><span class="line">        JsonUtility.FromJsonOverwrite(str, bulletData); //根据Json字符串反序列化出数据，将内容覆盖到bulletData数据文件中</span><br></pre></td></tr></table></figure>

<p>但是实际上，让 ScriptableObject 真正意义上数据持久化有点画蛇添足的感觉。因为既然已经要用到持久化数据的方法，那为什么不全部用它们来进行数据交互呢？其实可以自定义一个数据结构类，让它与数据持久化的方法进行交互，而不是再去创建一个类继承自 ScriptableObject。</p>
<h3 id="📕-Ⅴ-单例模块获取数据"><a href="#📕-Ⅴ-单例模块获取数据" class="headerlink" title="📕 Ⅴ. 单例模块获取数据"></a>📕 Ⅴ. 单例模块获取数据</h3><p>之前介绍使用数据文件的时候，要么是通过声明 public 变量在 Inspector 面板中进行拖拽关联，要么是使用资源加载的方法。</p>
<p>如果用拖拽的方式，物体之间的拖拽关系可能会随着项目量的增长而变复杂，不利用后续的维护。😟<br>如果用资源加载的方式，以 Resources 为例，可能就要写大量的 Resources. Load 方法，其实是有一点重复工作的。😟</p>
<p>因此可以将 ScriptableObject 实例<strong>通过单例模式化</strong>去获取，减少重复代码，提高编码效率：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingleScriptableObject</span>&lt;<span class="title">T</span>&gt; : <span class="title">ScriptableObject</span> <span class="keyword">where</span> <span class="title">T</span> :<span class="title">ScriptableObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//所有数据资源文件都放在Resources文件夹下加载对应的数据资源文件</span></span><br><span class="line">    <span class="comment">//对需要复用的唯一的数据资源文件名定一个规则：文件名和类名一致</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span> scriptableObjectPath = <span class="string">&quot;ScriptableObject/&quot;</span>+<span class="keyword">typeof</span>(T).Name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> T instance;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> T Instance</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (instance == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//如果为空，首先应该去资源路径下加载对应的数据资源文件</span></span><br><span class="line">                instance = Resources.Load&lt;T&gt;(scriptableObjectPath);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果没有这个文件，直接创建一个数据</span></span><br><span class="line">            <span class="keyword">if</span> (instance == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                instance = CreateInstance&lt;T&gt;();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;      </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假如说我要去调用子弹数据，我就让 BulletData 类继承自 SingleScriptableObject 类，然后直接这样调用就行了：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BulletData. Instance. speed</span><br></pre></td></tr></table></figure>

<h2 id="🔍-总结"><a href="#🔍-总结" class="headerlink" title="🔍 总结"></a>🔍 总结</h2><p>那么 ScriptableObject 的相关基础知识点差不多就介绍完了。<br>对于<strong>只用不变</strong>的数据，就适合用 ScriptableObject 做<strong>数据配置文件</strong>，再加上<strong>编辑模式下可实现数据持久化</strong>的特点，我们可以在 <strong>Inspector 面板中进行数据的配置与调试</strong>，有的时候是更加方便的，并且可以达到<strong>数据复用</strong>的目的，减少内存消耗。但是它无法在游戏打包发布后将数据的变动存储到磁盘中。因此我们要熟悉 ScriptableObject 的优缺点，结合实际需求选择使用。🌹</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://liuke101.github.io">灵玉</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://liuke101.github.io/post/62114.html">http://liuke101.github.io/post/62114.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://liuke101.github.io" target="_blank">游戏江湖</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Unity/">Unity</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190020794.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赏碎银二两</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202404232247905.jpg" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202404232247905.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202404232251074.jpg" target="_blank"><img class="post-qr-code-img" src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202404232251074.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/1888.html" title="Unity编辑器扩展"><img class="cover" src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190021833.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Unity编辑器扩展</div></div></a></div><div class="next-post pull-right"><a href="/post/23284.html" title="C#精粹"><img class="cover" src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190029681.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">C#精粹</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/64623.html" title="Unity GUI"><img class="cover" src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190021833.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-19</div><div class="title">Unity GUI</div></div></a></div><div><a href="/post/21879.html" title="Unity Primer"><img class="cover" src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190029709.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-19</div><div class="title">Unity Primer</div></div></a></div><div><a href="/post/1888.html" title="Unity编辑器扩展"><img class="cover" src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190021833.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-19</div><div class="title">Unity编辑器扩展</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="comment-switch"><span class="first-comment">Waline</span><span id="switch-btn"></span><span class="second-comment">Livere</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div><div><div id="lv-container" data-id="city" data-uid="MTAyMC81OTc3Ny8zNjIzOQ=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/I168.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">灵玉</div><div class="author-info__description">游戏开发</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">48</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/liuke101"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/liuke101" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="/gamerlk@163.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">1. 文章主要迁移自个人的obsidian笔记，存在部分md语法冲突，导致显示异常，暂未修复。 2. 文章部分内容参考/引用网络资源，用于个人学习，如有侵权，请联系我删除。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Playerprefs"><span class="toc-text">Playerprefs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%96%B9%E6%B3%95"><span class="toc-text">基本方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B"><span class="toc-text">存储其他类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE"><span class="toc-text">存储位置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Playerprefs-%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B1%BB"><span class="toc-text">Playerprefs 数据管理类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-text">案例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Json"><span class="toc-text">Json</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99"><span class="toc-text">语法规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Excel-%E8%BD%AC-Json"><span class="toc-text">Excel 转 Json</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JsonUtlity"><span class="toc-text">JsonUtlity</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AF%BB%E5%86%99%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-text">在文件中读写字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LitJson"><span class="toc-text">LitJson</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-LitJson"><span class="toc-text">获取 LitJson</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96-1"><span class="toc-text">序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-1"><span class="toc-text">反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-1"><span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Json-%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B1%BB"><span class="toc-text">Json 数据管理类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96-2"><span class="toc-text">序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-2"><span class="toc-text">反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95"><span class="toc-text">扩展</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CSV"><span class="toc-text">CSV</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%9C%A8%E8%A1%A8%E6%A0%BC%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E3%80%82"><span class="toc-text">程序在表格文件中读取数据。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ScriptableObject"><span class="toc-text">ScriptableObject</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%8D-%E4%BB%80%E4%B9%88%E6%98%AF-ScriptableObject"><span class="toc-text">🔍 什么是 ScriptableObject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%8D-ScriptableObject-%E7%9A%84%E4%B8%BB%E8%A6%81%E4%BD%9C%E7%94%A8"><span class="toc-text">🔍 ScriptableObject 的主要作用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%92%AA-%E7%BC%96%E8%BE%91%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">💪 编辑模式下的数据持久化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%92%AA-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">💪 配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%92%AA-%E6%95%B0%E6%8D%AE%E5%A4%8D%E7%94%A8"><span class="toc-text">💪 数据复用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%8D-%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA-ScriptableObject"><span class="toc-text">🔍 如何创建 ScriptableObject</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%95-%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E5%A3%B0%E6%98%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AE%B9%E5%99%A8"><span class="toc-text">📕 步骤一：声明自定义的数据容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%95-%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E6%A0%B9%E6%8D%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84-ScriptableObject-%E6%95%B0%E6%8D%AE%E5%AE%B9%E5%99%A8%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6"><span class="toc-text">📕 步骤二：根据自定义的 ScriptableObject 数据容器创建数据文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%98%8A-%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E4%B8%BA%E7%B1%BB%E6%B7%BB%E5%8A%A0-CreateAssetMenu-%E7%89%B9%E6%80%A7%EF%BC%8C%E5%9C%A8%E7%BC%96%E8%BE%91%E5%99%A8%E7%9A%84%E8%8F%9C%E5%8D%95%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-text">😊 方法一：为类添加 CreateAssetMenu 特性，在编辑器的菜单中创建资源文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%98%8A-%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E5%88%A9%E7%94%A8-ScriptableObject-%E7%9A%84%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%AF%B9%E8%B1%A1%EF%BC%8C%E7%84%B6%E5%90%8E%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AF%B9%E8%B1%A1%E4%BF%9D%E5%AD%98%E5%9C%A8%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95%E4%B8%8B"><span class="toc-text">😊 方法二：利用 ScriptableObject 的静态方法创建数据对象，然后将数据对象保存在工程目录下</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%98%8A-%E6%80%BB%E7%BB%93%E5%88%9B%E5%BB%BA-ScriptableObject-%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-text">😊 总结创建 ScriptableObject 的步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%8D-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-ScriptableObject"><span class="toc-text">🔍 如何使用 ScriptableObject</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%95-%E2%85%A0-%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">📕 Ⅰ. 数据文件的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%98%8A%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E9%80%9A%E8%BF%87-Inspector-%E9%9D%A2%E6%9D%BF%E4%B8%AD%E7%9A%84-public-%E5%8F%98%E9%87%8F%E8%BF%9B%E8%A1%8C%E5%85%B3%E8%81%94"><span class="toc-text">😊方法一：通过 Inspector 面板中的 public 变量进行关联</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%F0%9F%98%8A%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E7%9B%B4%E6%8E%A5%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-text">😊方法二：直接加载数据资源文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%95-%E2%85%A1-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-text">📕 Ⅱ. 生命周期函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%95-%E2%85%A2-%E5%AE%9E%E7%8E%B0%E9%9D%9E%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE"><span class="toc-text">📕 Ⅲ. 实现非持久化数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%95-%E2%85%A3-%E8%AE%A9-ScriptableObject-%E7%9C%9F%E6%AD%A3%E6%84%8F%E4%B9%89%E4%B8%8A%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">📕 Ⅳ. 让 ScriptableObject 真正意义上持久化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%95-%E2%85%A4-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%9D%97%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-text">📕 Ⅴ. 单例模块获取数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%8D-%E6%80%BB%E7%BB%93"><span class="toc-text">🔍 总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/42467.html" title="HLSL ShaderLab">HLSL ShaderLab</a><time datetime="2024-05-18T16:49:50.000Z" title="发表于 2024-05-19 00:49:50">2024-05-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/42466.html" title="CG ShaderLab">CG ShaderLab</a><time datetime="2024-05-18T16:48:56.000Z" title="发表于 2024-05-19 00:48:56">2024-05-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/21838.html" title="冯乐乐入门精要笔记">冯乐乐入门精要笔记</a><time datetime="2024-05-18T16:45:45.000Z" title="发表于 2024-05-19 00:45:45">2024-05-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/21879.html" title="Unity Primer"><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190029709.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unity Primer"/></a><div class="content"><a class="title" href="/post/21879.html" title="Unity Primer">Unity Primer</a><time datetime="2024-05-18T16:36:03.000Z" title="发表于 2024-05-19 00:36:03">2024-05-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/64623.html" title="Unity GUI"><img src="https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190021833.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unity GUI"/></a><div class="content"><a class="title" href="/post/64623.html" title="Unity GUI">Unity GUI</a><time datetime="2024-05-18T16:32:22.000Z" title="发表于 2024-05-19 00:32:22">2024-05-19</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/liuke101/PicGo-For-Hexo/image/202405190020794.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 By 灵玉</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  let initFn = window.walineFn || null

  const initWaline = (Fn) => {
    const waline = Fn(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://waline-server-indol.vercel.app/',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: true,
    }, null))

    const destroyWaline = () => {
      waline.destroy()
    }

    btf.addGlobalFn('pjax', destroyWaline, 'destroyWaline')
  }

  const loadWaline = async () => {
    if (initFn) initWaline(initFn)
    else {
      await getCSS('https://cdn.jsdelivr.net/npm/@waline/client@3.1.2/dist/waline.min.css')
      const { init } = await import('https://cdn.jsdelivr.net/npm/@waline/client@3.1.2/dist/waline.min.js')
      initFn = init || Waline.init
      initWaline(initFn)
      window.walineFn = initFn
    }
  }

  if ('Waline' === 'Waline' || !false) {
    if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><script>(()=>{
  const loadLivere = () => {
    if (typeof LivereTower === 'object') window.LivereTower.init()
    else {
      (function(d, s) {
          var j, e = d.getElementsByTagName(s)[0];
          if (typeof LivereTower === 'function') { return; }
          j = d.createElement(s);
          j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
          j.async = true;
          e.parentNode.insertBefore(j, e);
      })(document, 'script');
    }
  }

  if ('Waline' === 'Livere' || !false) {
    if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
    else loadLivere()
  } else {
    window.loadOtherComment = loadLivere
  }
})()</script></div><script>window.addEventListener('load', () => {
  const changeContent = content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = async () => {
    try {
      const res = await fetch('https://waline-server-indol.vercel.app/api/comment?type=recent&count=6', { method: 'GET' })
      const result = await res.json()
      const walineArray = result.data.map(e => {
        return {
          'content': changeContent(e.comment),
          'avatar': e.avatar,
          'nick': e.nick,
          'url': e.url + '#' + e.objectId,
          'date': e.time || e.insertedAt
        }
      })
      saveToLocal.set('waline-newest-comments', JSON.stringify(walineArray), 10/(60*24))
      generateHtml(walineArray)
    } catch (err) {
      console.error(err)
      const $dom = document.querySelector('#card-newest-comments .aside-list')
      $dom.textContent= "无法获取评论，请确认相关配置是否正确"
    }
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('waline-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><div class="aplayer no-destroy" data-id="9896988395" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true"> </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.22.1/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.65.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js?v=4.13.0"></script></div></div></body></html>